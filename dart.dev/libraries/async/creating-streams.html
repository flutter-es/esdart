<!doctype html><html lang="en">
<!-- Mirrored from dart.dev/libraries/async/creating-streams by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Dec 2024 22:14:25 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="../../../www.googletagmanager.com/gtm4a44.js?id=GTM-5VSZM5J",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script><meta name="description" content="A stream is a sequence of results; learn how to create your own."><title>Creating streams in Dart | Dart</title><link rel="icon" sizes="64x64" href="../../assets/img/logo/dart-64.png" eleventy:ignore><link href="../../assets/img/touch-icon-iphone.png" rel="apple-touch-icon" eleventy:ignore><link href="../../assets/img/touch-icon-ipad.png" rel="apple-touch-icon" sizes="152x152" eleventy:ignore><link href="../../assets/img/touch-icon-iphone-retina.png" rel="apple-touch-icon" sizes="180x180" eleventy:ignore><link href="../../assets/img/touch-icon-ipad-retina.png" rel="apple-touch-icon" sizes="167x167" eleventy:ignore><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@dart_lang"><meta name="twitter:title" content="Creating streams in Dart"><meta name="twitter:description" content="A stream is a sequence of results; learn how to create your own."><meta property="og:title" content="Creating streams in Dart"><meta property="og:description" content="A stream is a sequence of results; learn how to create your own."><meta property="og:url" content="/libraries/async/creating-streams/"><meta property="og:image" content="/assets/img/logo/dart-logo-for-shares.png?2" eleventy:ignore><link rel="preconnect" href="https://fonts.googleapis.com/"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Google+Sans+Display:wght@400&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Google+Sans+Mono:wght@400;500;700&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Google+Sans+Text:wght@400;500;700&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet"><link rel="stylesheet" href="../../assets/css/main.css"><script src="../../../cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha512-3gJwYpMe3QewGELv8k/BX9vcqhryRdzRMxVfq6ngyWXwo03GFEzjsUm8Q7RZcHPHksttq7/GFoxjCVUjkjvPdw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><script src="../../../cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous" referrerpolicy="no-referrer"></script><script src="../../../cdnjs.cloudflare.com/ajax/libs/js-cookie/3.0.5/js.cookie.min.js" integrity="sha512-nlp9/l96/EpjYBx7EP7pGASVXNe80hGhYAUrjeXnu/fyF5Py0/RXav4BBNs7n5Hx1WFhOEOWSAVjGeC3oKxDVQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><script src="../../assets/js/os-tabs.js"></script><script src="../../assets/js/utilities.js"></script><script src="../../assets/js/main.js"></script><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src="../../../www.google-analytics.com/analytics.js",s.parentNode.insertBefore(o,s)}(window,document,"script",0,"ga"),ga("create","UA-26406144-4","auto"),ga("send","pageview")</script></head><body class="default.html show_banner"><a id="skip" href="#site-content-title">Skip to main content</a><section id="cookie-notice"><div class="container"><p>dart.dev uses cookies from Google to deliver and enhance the quality of its services and to analyze traffic. <a href="https://policies.google.com/technologies/cookies" target="_blank" rel="noopener">Learn more</a>.</p><button id="cookie-consent" class="btn btn-primary">OK, got it</button></div></section><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5VSZM5J" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><header id="page-header" class="site-header"><nav id="mainnav" class="site-header"><div id="menu-toggle"><i class="material-symbols">menu</i></div><a href="../../index.html" class="brand" title="Dart"><img src="../../assets/img/logo/logo-white-text.svg" alt="Dart"></a><ul class="navbar"><li><a href="../../overview.html" class="nav-link">Overview</a></li><li class="mainnav__get-started"><a href="../../guides.html" class="nav-link active"><span>Docs</span></a></li><li><a href="../../community.html" class="nav-link">Community</a></li><li><a href="../../index.html#try-dart" class="nav-link">Try Dart</a></li><li><a href="../../get-dart.html" class="nav-link">Get Dart</a></li><li class="searchfield"><form action="https://dart.dev/search" class="site-header__search form-inline" id="cse-search-box"><input type="hidden" name="cx" value="011220921317074318178:_yy-tmb5t_i"> <input type="hidden" name="ie" value="UTF-8"> <input type="hidden" name="hl" value="en"> <input class="site-header__searchfield form-control search-field" type="search" name="q" id="search-main" autocomplete="off" placeholder="Search" aria-label="Search"></form></li></ul></nav></header><div class="banner"><p class="banner__text">Dart 3.6 is here! Read the <a href="https://medium.com/dartlang/announcing-dart-3-6-778dd7a80983" target="_blank">blog post</a> to learn about new features in pub and the language.</p></div><div id="sidenav"><form action="https://dart.dev/search/" class="site-header__search form-inline"><input class="site-header__searchfield form-control search-field" type="search" name="q" id="search-side" autocomplete="off" placeholder="Search" aria-label="Search"></form><div class="site-sidebar"><ul class="navbar-nav"><li class="nav-item"><a href="../../overview.html" class="nav-link">Overview</a></li><li class="nav-item"><a href="../../community.html" class="nav-link">Community</a></li><li class="nav-item"><a href="https://dartpad.dev/" class="nav-link">Try Dart</a></li><li class="nav-item"><a href="../../get-dart.html" class="nav-link">Get Dart</a></li><li class="nav-item"><a href="../../guides.html" class="nav-link">Docs</a></li><li aria-hidden="true"><div class="sidebar-primary-divider"></div></li></ul><ul class="nav flex-column"><li class="nav-item"><a class="nav-link collapsed collapsible" data-toggle="collapse" href="#sidenav-1" role="button" aria-expanded="false" aria-controls="sidenav-1">Language</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-1"><li class="nav-item"><a class="nav-link" href="../../language.html">Introduction</a></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-1-2" href="#sidenav-1-2" role="button" aria-expanded="false" aria-controls="sidenav-1-2">Syntax basics</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-1-2"><li class="nav-item"><a class="nav-link" href="../../language/variables.html">Variables</a></li><li class="nav-item"><a class="nav-link" href="../../language/operators.html">Operators</a></li><li class="nav-item"><a class="nav-link" href="../../language/comments.html">Comments</a></li><li class="nav-item"><a class="nav-link" href="../../language/metadata.html">Metadata</a></li><li class="nav-item"><a class="nav-link" href="../../language/libraries.html">Libraries & imports</a></li><li class="nav-item"><a class="nav-link" href="../../language/keywords.html">Keywords</a></li></ul></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-1-3" href="#sidenav-1-3" role="button" aria-expanded="false" aria-controls="sidenav-1-3">Types</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-1-3"><li class="nav-item"><a class="nav-link" href="../../language/built-in-types.html">Built-in types</a></li><li class="nav-item"><a class="nav-link" href="../../language/records.html">Records</a></li><li class="nav-item"><a class="nav-link" href="../../language/collections.html">Collections</a></li><li class="nav-item"><a class="nav-link" href="../../language/generics.html">Generics</a></li><li class="nav-item"><a class="nav-link" href="../../language/typedefs.html">Typedefs</a></li><li class="nav-item"><a class="nav-link" href="../../language/type-system.html">Type system</a></li></ul></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-1-4" href="#sidenav-1-4" role="button" aria-expanded="false" aria-controls="sidenav-1-4">Patterns</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-1-4"><li class="nav-item"><a class="nav-link" href="../../language/patterns.html">Overview & usage</a></li><li class="nav-item"><a class="nav-link" href="../../language/pattern-types.html">Pattern types</a></li><li class="nav-item"><a class="nav-link" href="https://codelabs.developers.google.com/codelabs/dart-patterns-records" target="_blank" rel="noopener">Applied tutorial</a></li></ul></li><li class="nav-item"><a class="nav-link" href="../../language/functions.html">Functions</a></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-1-6" href="#sidenav-1-6" role="button" aria-expanded="false" aria-controls="sidenav-1-6">Control flow</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-1-6"><li class="nav-item"><a class="nav-link" href="../../language/loops.html">Loops</a></li><li class="nav-item"><a class="nav-link" href="../../language/branches.html">Branches</a></li><li class="nav-item"><a class="nav-link" href="../../language/error-handling.html">Error handling</a></li></ul></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-1-7" href="#sidenav-1-7" role="button" aria-expanded="false" aria-controls="sidenav-1-7">Classes & objects</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-1-7"><li class="nav-item"><a class="nav-link" href="../../language/classes.html">Classes</a></li><li class="nav-item"><a class="nav-link" href="../../language/constructors.html">Constructors</a></li><li class="nav-item"><a class="nav-link" href="../../language/methods.html">Methods</a></li><li class="nav-item"><a class="nav-link" href="../../language/extend.html">Extend a class</a></li><li class="nav-item"><a class="nav-link" href="../../language/mixins.html">Mixins</a></li><li class="nav-item"><a class="nav-link" href="../../language/enums.html">Enums</a></li><li class="nav-item"><a class="nav-link" href="../../language/extension-methods.html">Extension methods</a></li><li class="nav-item"><a class="nav-link" href="../../language/extension-types.html">Extension types</a></li><li class="nav-item"><a class="nav-link" href="../../language/callable-objects.html">Callable objects</a></li></ul></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-1-8" href="#sidenav-1-8" role="button" aria-expanded="false" aria-controls="sidenav-1-8">Class modifiers</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-1-8"><li class="nav-item"><a class="nav-link" href="../../language/class-modifiers.html">Overview & usage</a></li><li class="nav-item"><a class="nav-link" href="../../language/class-modifiers-for-apis.html">Class modifiers for API maintainers</a></li><li class="nav-item"><a class="nav-link" href="../../language/modifier-reference.html">Reference</a></li></ul></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-1-9" href="#sidenav-1-9" role="button" aria-expanded="false" aria-controls="sidenav-1-9">Concurrency</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-1-9"><li class="nav-item"><a class="nav-link" href="../../language/concurrency.html">Overview</a></li><li class="nav-item"><a class="nav-link" href="../../language/async.html">Asynchronous support</a></li><li class="nav-item"><a class="nav-link" href="../../language/isolates.html">Isolates</a></li></ul></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-1-10" href="#sidenav-1-10" role="button" aria-expanded="false" aria-controls="sidenav-1-10">Null safety</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-1-10"><li class="nav-item"><a class="nav-link" href="../../null-safety.html">Sound null safety</a></li><li class="nav-item"><a class="nav-link" href="../../null-safety/migration-guide.html">Migrating to null safety</a></li><li class="nav-item"><a class="nav-link" href="../../null-safety/understanding-null-safety.html">Understanding null safety</a></li><li class="nav-item"><a class="nav-link" href="../../null-safety/unsound-null-safety.html">Unsound null safety</a></li><li class="nav-item"><a class="nav-link" href="../../null-safety/faq.html">FAQ</a></li></ul></li></ul></li><li class="nav-item"><a class="nav-link active collapsible" data-toggle="collapse" href="#sidenav-2" role="button" aria-expanded="true" aria-controls="sidenav-2">Core libraries</a><ul class="nav flex-column flex-nowrap collapse show" id="sidenav-2"><li class="nav-item"><a class="nav-link" href="../../libraries.html">Overview</a></li><li class="nav-item"><a class="nav-link" href="../dart-core.html">dart:core</a></li><li class="nav-item"><a class="nav-link" href="../dart-async.html">dart:async</a></li><li class="nav-item"><a class="nav-link" href="../dart-math.html">dart:math</a></li><li class="nav-item"><a class="nav-link" href="../dart-convert.html">dart:convert</a></li><li class="nav-item"><a class="nav-link" href="../dart-io.html">dart:io</a></li><li class="nav-item"><a class="nav-link" href="../dart-html.html">dart:html</a></li><div class="dropdown-divider"></div><li class="nav-item"><a class="nav-link" href="../collections/iterables.html">Iterable collections</a></li><li class="nav-item"><a class="nav-link active collapsible" data-toggle="collapse" data-target="#sidenav-2-10" href="#sidenav-2-10" role="button" aria-expanded="true" aria-controls="sidenav-2-10">Asynchronous programming</a><ul class="nav flex-column flex-nowrap collapse show" id="sidenav-2-10"><li class="nav-item"><a class="nav-link" href="async-await.html">Tutorial</a></li><li class="nav-item"><a class="nav-link" href="futures-error-handling.html">Futures and error handling</a></li><li class="nav-item"><a class="nav-link" href="using-streams.html">Using streams</a></li><li class="nav-item"><a class="nav-link active" href="creating-streams.html">Creating streams</a></li></ul></li></ul></li><li class="nav-item"><a class="nav-link collapsed collapsible" data-toggle="collapse" href="#sidenav-3" role="button" aria-expanded="false" aria-controls="sidenav-3">Effective Dart</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-3"><li class="nav-item"><a class="nav-link" href="../../effective-dart.html">Overview</a></li><li class="nav-item"><a class="nav-link" href="../../effective-dart/style.html">Style</a></li><li class="nav-item"><a class="nav-link" href="../../effective-dart/documentation.html">Documentation</a></li><li class="nav-item"><a class="nav-link" href="../../effective-dart/usage.html">Usage</a></li><li class="nav-item"><a class="nav-link" href="../../effective-dart/design.html">Design</a></li></ul></li><li class="nav-item"><a class="nav-link collapsed collapsible" data-toggle="collapse" href="#sidenav-4" role="button" aria-expanded="false" aria-controls="sidenav-4">Packages</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-4"><li class="nav-item"><a class="nav-link" href="../../tools/pub/packages.html">How to use packages</a></li><li class="nav-item"><a class="nav-link" href="../../resources/useful-packages.html">Commonly used packages</a></li><li class="nav-item"><a class="nav-link" href="../../tools/pub/create-packages.html">Creating packages</a></li><li class="nav-item"><a class="nav-link" href="../../tools/pub/publishing.html">Publishing packages</a></li><li class="nav-item"><a class="nav-link" href="../../tools/pub/writing-package-pages.html">Writing package pages</a></li><li class="nav-item"><a class="nav-link" href="../../tools/pub/workspaces.html">Workspaces (monorepo support)</a></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-4-7" href="#sidenav-4-7" role="button" aria-expanded="false" aria-controls="sidenav-4-7">Package reference</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-4-7"><li class="nav-item"><a class="nav-link" href="../../tools/pub/dependencies.html">Dependencies</a></li><li class="nav-item"><a class="nav-link" href="../../tools/pub/glossary.html">Glossary</a></li><li class="nav-item"><a class="nav-link" href="../../tools/pub/package-layout.html">Package layout conventions</a></li><li class="nav-item"><a class="nav-link" href="../../tools/pub/environment-variables.html">Pub environment variables</a></li><li class="nav-item"><a class="nav-link" href="../../tools/pub/pubspec.html">Pubspec file</a></li><li class="nav-item"><a class="nav-link" href="../../tools/pub/troubleshoot.html">Troubleshooting pub</a></li><li class="nav-item"><a class="nav-link" href="../../tools/pub/verified-publishers.html">Verified publishers</a></li><li class="nav-item"><a class="nav-link" href="../../tools/pub/security-advisories.html">Security advisories</a></li><li class="nav-item"><a class="nav-link" href="../../tools/pub/versioning.html">Versioning</a></li><li class="nav-item"><a class="nav-link" href="../../tools/pub/custom-package-repositories.html">Custom package repositories</a></li></ul></li><li class="nav-item"><a class="nav-link" href="../../tools/pub/private-files.html">What not to commit</a></li></ul></li><li class="nav-item"><a class="nav-link collapsed collapsible" data-toggle="collapse" href="#sidenav-5" role="button" aria-expanded="false" aria-controls="sidenav-5">Development</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-5"><li class="nav-item"><a class="nav-link" href="../../guides/json.html">JSON</a></li><li class="nav-item"><a class="nav-link" href="../../resources/language/number-representation.html">Number representation</a></li><li class="nav-item"><a class="nav-link" href="../../resources/google-apis.html">Google APIs</a></li><li class="nav-item"><a class="nav-link" href="../../multiplatform-apps.html">Multi-platform apps</a></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-5-5" href="#sidenav-5-5" role="button" aria-expanded="false" aria-controls="sidenav-5-5">Command-line & server apps</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-5-5"><li class="nav-item"><a class="nav-link" href="../../server.html">Overview</a></li><li class="nav-item"><a class="nav-link" href="../../tutorials/server/get-started.html">Get started</a></li><li class="nav-item"><a class="nav-link" href="../../tutorials/server/cmdline.html">Write command-line apps</a></li><li class="nav-item"><a class="nav-link" href="../../tutorials/server/fetch-data.html">Fetch data from the internet</a></li><li class="nav-item"><a class="nav-link" href="../../tutorials/server/httpserver.html">Write HTTP servers</a></li><li class="nav-item"><a class="nav-link" href="../../server/libraries.html">Libraries & packages</a></li><li class="nav-item"><a class="nav-link" href="../../server/google-cloud.html">Google Cloud</a></li></ul></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-5-6" href="#sidenav-5-6" role="button" aria-expanded="false" aria-controls="sidenav-5-6">Web apps</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-5-6"><li class="nav-item"><a class="nav-link" href="../../web.html">Overview</a></li><li class="nav-item"><a class="nav-link" href="../../web/get-started.html">Get started</a></li><li class="nav-item"><a class="nav-link" href="../../web/deployment.html">Deployment</a></li><li class="nav-item"><a class="nav-link" href="../../web/libraries.html">Libraries & packages</a></li><li class="nav-item"><a class="nav-link" href="../../web/wasm.html">Wasm compilation</a></li></ul></li><li class="nav-item"><a class="nav-link" href="../../guides/environment-declarations.html">Environment declarations</a></li></ul></li><li class="nav-item"><a class="nav-link collapsed collapsible" data-toggle="collapse" href="#sidenav-6" role="button" aria-expanded="false" aria-controls="sidenav-6">Interoperability</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-6"><li class="nav-item"><a class="nav-link" href="../../interop/c-interop.html">C interop</a></li><li class="nav-item"><a class="nav-link" href="../../interop/objective-c-interop.html">Objective-C & Swift interop</a></li><li class="nav-item"><a class="nav-link" href="../../interop/java-interop.html">Java & Kotlin interop</a></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-6-4" href="#sidenav-6-4" role="button" aria-expanded="false" aria-controls="sidenav-6-4">JavaScript interop</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-6-4"><li class="nav-item"><a class="nav-link" href="../../interop/js-interop.html">Overview</a></li><li class="nav-item"><a class="nav-link" href="../../interop/js-interop/usage.html">Usage</a></li><li class="nav-item"><a class="nav-link" href="../../interop/js-interop/js-types.html">JS types</a></li><li class="nav-item"><a class="nav-link" href="../../interop/js-interop/tutorials.html">Tutorials</a></li><li class="nav-item"><a class="nav-link" href="../../interop/js-interop/past-js-interop.html">Past JS interop</a></li><div class="dropdown-divider"></div><li class="nav-item"><a class="nav-link" href="../../interop/js-interop/package-web.html">Web interop</a></li></ul></li></ul></li><li class="nav-item"><a class="nav-link collapsed collapsible" data-toggle="collapse" href="#sidenav-7" role="button" aria-expanded="false" aria-controls="sidenav-7">Tools & techniques</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-7"><li class="nav-item"><a class="nav-link" href="../../tools.html">Overview</a></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-7-2" href="#sidenav-7-2" role="button" aria-expanded="false" aria-controls="sidenav-7-2">Editors & debuggers</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-7-2"><li class="nav-item"><a class="nav-link" href="../../tools/jetbrains-plugin.html">IntelliJ & Android Studio</a></li><li class="nav-item"><a class="nav-link" href="../../tools/vs-code.html">VS Code</a></li><li class="nav-item"><a class="nav-link" href="../../tools/dart-devtools.html">Dart DevTools</a></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-7-2-4" href="#sidenav-7-2-4" role="button" aria-expanded="false" aria-controls="sidenav-7-2-4">DartPad</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-7-2-4"><li class="nav-item"><a class="nav-link" href="../../tools/dartpad.html">Overview</a></li><li class="nav-item"><a class="nav-link" href="../../tools/dartpad/troubleshoot.html">Troubleshooting DartPad</a></li></ul></li></ul></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-7-3" href="#sidenav-7-3" role="button" aria-expanded="false" aria-controls="sidenav-7-3">Command-line tools</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-7-3"><li class="nav-item"><a class="nav-link collapsible" data-toggle="collapse" data-target="#sidenav-7-3-1" href="#sidenav-7-3-1" role="button" aria-expanded="true" aria-controls="sidenav-7-3-1">Dart SDK</a><ul class="nav flex-column flex-nowrap collapse show" id="sidenav-7-3-1"><li class="nav-item"><a class="nav-link" href="../../tools/sdk.html">Overview</a></li><li class="nav-item"><a class="nav-link" href="../../tools/dart-tool.html">dart</a></li><li class="nav-item"><a class="nav-link" href="../../tools/dart-analyze.html">dart analyze</a></li><li class="nav-item"><a class="nav-link" href="../../tools/dart-compile.html">dart compile</a></li><li class="nav-item"><a class="nav-link" href="../../tools/dart-create.html">dart create</a></li><li class="nav-item"><a class="nav-link" href="../../tools/dart-doc.html">dart doc</a></li><li class="nav-item"><a class="nav-link" href="../../tools/dart-fix.html">dart fix</a></li><li class="nav-item"><a class="nav-link" href="../../tools/dart-format.html">dart format</a></li><li class="nav-item"><a class="nav-link" href="../../tools/dart-info.html">dart info</a></li><li class="nav-item"><a class="nav-link" href="../../tools/pub/cmd.html">dart pub</a></li><li class="nav-item"><a class="nav-link" href="../../tools/dart-run.html">dart run</a></li><li class="nav-item"><a class="nav-link" href="../../tools/dart-test.html">dart test</a></li><li class="nav-item"><a class="nav-link" href="../../tools/dartaotruntime.html">dartaotruntime</a></li><li class="nav-item"><a class="nav-link" href="../../tools/experiment-flags.html">Experiment flags</a></li></ul></li><li class="nav-item"><a class="nav-link collapsible" data-toggle="collapse" data-target="#sidenav-7-3-2" href="#sidenav-7-3-2" role="button" aria-expanded="true" aria-controls="sidenav-7-3-2">Other command-line tools</a><ul class="nav flex-column flex-nowrap collapse show" id="sidenav-7-3-2"><li class="nav-item"><a class="nav-link" href="../../tools/build_runner.html">build_runner</a></li><li class="nav-item"><a class="nav-link" href="../../tools/webdev.html">webdev</a></li></ul></li></ul></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-7-4" href="#sidenav-7-4" role="button" aria-expanded="false" aria-controls="sidenav-7-4">Static analysis</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-7-4"><li class="nav-item"><a class="nav-link" href="../../tools/analysis.html">Customizing static analysis</a></li><li class="nav-item"><a class="nav-link" href="../../deprecated/sound-problems.html">Fixing common type problems</a></li><li class="nav-item"><a class="nav-link" href="../../tools/non-promotion-reasons.html">Fixing type promotion failures</a></li><li class="nav-item"><a class="nav-link" href="../../tools/linter-rules.html">Linter rules</a></li><li class="nav-item"><a class="nav-link" href="../../tools/diagnostic-messages.html">Diagnostic messages</a></li></ul></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-7-5" href="#sidenav-7-5" role="button" aria-expanded="false" aria-controls="sidenav-7-5">Testing & optimization</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-7-5"><li class="nav-item"><a class="nav-link" href="../../guides/testing.html">Testing</a></li><li class="nav-item"><a class="nav-link" href="../../web/debugging.html">Debugging web apps</a></li></ul></li></ul></li><li aria-hidden="true"><div class="sidebar-primary-divider"></div></li><li class="nav-item"><a class="nav-link collapsed collapsible" data-toggle="collapse" href="#sidenav-9" role="button" aria-expanded="false" aria-controls="sidenav-9">Resources</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-9"><li class="nav-item"><a class="nav-link" href="../../resources/dart-cheatsheet.html">Language cheatsheet</a></li><li class="nav-item"><a class="nav-link" href="../../resources/breaking-changes.html">Breaking changes</a></li><li class="nav-item"><a class="nav-link" href="../../resources/language/evolution.html">Language evolution</a></li><li class="nav-item"><a class="nav-link" href="../../resources/language/spec.html">Language specification</a></li><li class="nav-item"><a class="nav-link" href="../../resources/dart-3-migration.html">Dart 3 migration guide</a></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-9-6" href="#sidenav-9-6" role="button" aria-expanded="false" aria-controls="sidenav-9-6">Coming from ...</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-9-6"><li class="nav-item"><a class="nav-link" href="../../resources/coming-from/js-to-dart.html">JavaScript to Dart</a></li><li class="nav-item"><a class="nav-link" href="../../resources/coming-from/swift-to-dart.html">Swift to Dart</a></li></ul></li><div class="dropdown-divider"></div><li class="nav-item"><a class="nav-link" href="../../resources/faq.html">FAQ</a></li><li class="nav-item"><a class="nav-link" href="../../resources/glossary.html">Glossary</a></li><li class="nav-item"><a class="nav-link" href="../../resources/books.html">Books</a></li><li class="nav-item"><a class="nav-link" href="../../resources/videos.html">Videos</a></li><li class="nav-item"><a class="nav-link" href="../../tutorials.html">Tutorials</a></li></ul></li><li class="nav-item"><a class="nav-link collapsible" data-toggle="collapse" href="#sidenav-10" role="button" aria-expanded="true" aria-controls="sidenav-10">Related sites</a><ul class="nav flex-column flex-nowrap collapse show" id="sidenav-10"><li class="nav-item"><a class="nav-link" href="https://api.dart.dev/" target="_blank" rel="noopener">API reference</a></li><li class="nav-item"><a class="nav-link" href="https://medium.com/dartlang" target="_blank" rel="noopener">Blog</a></li><li class="nav-item"><a class="nav-link" href="https://dartpad.dev/" target="_blank" rel="noopener">DartPad (online editor)</a></li><li class="nav-item"><a class="nav-link" href="https://flutter.dev/" target="_blank" rel="noopener">Flutter</a></li><li class="nav-item"><a class="nav-link" href="https://pub.dev/" target="_blank" rel="noopener">Package site</a></li></ul></li></ul></div></div><main id="page-content"><div id="site-toc--side" class="site-toc"><header class="site-toc__title">Contents</header><ul class="section-nav"><li class="toc-entry nav-item"><a class="nav-link" href="#transforming-an-existing-stream">Transforming an existing stream</a></li><li class="toc-entry nav-item"><a class="nav-link" href="#creating-a-stream-from-scratch">Creating a stream from scratch</a></li><li class="toc-entry nav-item"><a class="nav-link" href="#using-a-streamcontroller">Using a StreamController</a><ul class="nav"><li class="toc-entry nav-item"><a class="nav-link" href="#waiting-for-a-subscription">Waiting for a subscription</a></li><li class="toc-entry nav-item"><a class="nav-link" href="#honoring-the-pause-state">Honoring the pause state</a></li></ul></li><li class="toc-entry nav-item"><a class="nav-link" href="#final-hints">Final hints</a></li></ul></div><article><div class="content"><div id="site-content-title"><h1>Creating streams in Dart</h1></div><div id="site-toc--inline" class="site-toc"><header class="site-toc__title">Contents</header><ul class="section-nav"><li class="toc-entry"><a href="#transforming-an-existing-stream">Transforming an existing stream</a></li><li class="toc-entry"><a href="#creating-a-stream-from-scratch">Creating a stream from scratch</a></li><li class="toc-entry"><a href="#using-a-streamcontroller">Using a StreamController</a><ul><li class="toc-entry"><a href="#waiting-for-a-subscription">Waiting for a subscription</a></li><li class="toc-entry"><a href="#honoring-the-pause-state">Honoring the pause state</a></li></ul></li><li class="toc-entry"><a href="#final-hints">Final hints</a></li></ul></div><style>.comment {color:red;}</style><p><em>Written by Lasse Nielsen<br>April 2013 (updated May 2021)</em></p><p>The dart:async library contains two types that are important for many Dart APIs: <a href="https://api.dart.dev/dart-async/Stream-class.html">Stream</a> and <a href="https://api.dart.dev/dart-async/Future-class.html">Future.</a> Where a Future represents the result of a single computation, a stream is a <em>sequence</em> of results. You listen on a stream to get notified of the results (both data and errors) and of the stream shutting down. You can also pause while listening or stop listening to the stream before it is complete.</p><p>But this article is not about <em>using</em> streams. It's about creating your own streams. You can create streams in a few ways:</p><ul><li>Transforming existing streams.</li><li>Creating a stream from scratch by using an <code>async*</code> function.</li><li>Creating a stream by using a <code>StreamController</code>.</li></ul><p>This article shows the code for each approach and gives tips to help you implement your stream correctly.</p><p>For help on using streams, see <a href="using-streams.html">Asynchronous Programming: Streams</a>.</p><div class="header-wrapper"><h2 id="transforming-an-existing-stream">Transforming an existing stream</h2><a class="heading-link" href="#transforming-an-existing-stream" aria-label="Link to 'Transforming an existing stream' section">#</a></div><p>The common case for creating streams is that you already have a stream, and you want to create a new stream based on the original stream's events. For example you might have a stream of bytes that you want to convert to a stream of strings by UTF-8 decoding the input. The most general approach is to create a new stream that waits for events on the original stream and then outputs new events. Example:</p> <?code-excerpt "misc/lib/articles/creating-streams/line_stream_generator.dart (split-into-lines)"?> <div class="code-block-wrapper language-dart"><div class="code-block-body"><span class="code-block-language" title="Language dart">dart</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#6E6E70">/// Splits a stream of consecutive strings into lines.</span></span>
<span class="line"><span style="color:#6E6E70">///</span></span>
<span class="line"><span style="color:#6E6E70">/// The input string is provided in smaller chunks through</span></span>
<span class="line"><span style="color:#6E6E70">/// the </span><span style="color:#222222">`source`</span><span style="color:#6E6E70"> stream.</span></span>
<span class="line"><span style="color:#0468D7">Stream</span><span style="color:#222222">&#x3C;</span><span style="color:#0468D7">String</span><span style="color:#222222">> </span><span style="color:#6200EE">lines</span><span style="color:#222222">(</span><span style="color:#0468D7">Stream</span><span style="color:#222222">&#x3C;</span><span style="color:#0468D7">String</span><span style="color:#222222">> source) </span><span style="color:#D43324">async</span><span style="color:#222222">* {</span></span>
<span class="line"><span style="color:#6E6E70">  // Stores any partial line from the previous chunk.</span></span>
<span class="line"><span style="color:#D43324">  var</span><span style="color:#222222"> partial = </span><span style="color:#11796D">''</span><span style="color:#222222">;</span></span>
<span class="line"><span style="color:#6E6E70">  // Wait until a new chunk is available, then process it.</span></span>
<span class="line"><span style="color:#D43324">  await</span><span style="color:#D43324"> for</span><span style="color:#222222"> (</span><span style="color:#D43324">final</span><span style="color:#222222"> chunk </span><span style="color:#D43324">in</span><span style="color:#222222"> source) {</span></span>
<span class="line"><span style="color:#D43324">    var</span><span style="color:#222222"> lines = chunk.</span><span style="color:#6200EE">split</span><span style="color:#222222">(</span><span style="color:#11796D">'</span><span style="color:#222222">\n</span><span style="color:#11796D">'</span><span style="color:#222222">);</span></span>
<span class="line"><span style="color:#222222">    lines[</span><span style="color:#11796D">0</span><span style="color:#222222">] = partial + lines[</span><span style="color:#11796D">0</span><span style="color:#222222">]; </span><span style="color:#6E6E70">// Prepend partial line.</span></span>
<span class="line"><span style="color:#222222">    partial = lines.</span><span style="color:#6200EE">removeLast</span><span style="color:#222222">(); </span><span style="color:#6E6E70">// Remove new partial line.</span></span>
<span class="line"><span style="color:#D43324">    for</span><span style="color:#222222"> (</span><span style="color:#D43324">final</span><span style="color:#222222"> line </span><span style="color:#D43324">in</span><span style="color:#222222"> lines) {</span></span>
<span class="line"><span style="color:#D43324">      yield</span><span style="color:#222222"> line; </span><span style="color:#6E6E70">// Add lines to output stream.</span></span>
<span class="line"><span style="color:#222222">    }</span></span>
<span class="line"><span style="color:#222222">  }</span></span>
<span class="line"><span style="color:#6E6E70">  // Add final partial line to output stream, if any.</span></span>
<span class="line"><span style="color:#D43324">  if</span><span style="color:#222222"> (partial.isNotEmpty) </span><span style="color:#D43324">yield</span><span style="color:#222222"> partial;</span></span>
<span class="line"><span style="color:#222222">}</span></span></code></pre></div></div><p>For many common transformations, you can use <code>Stream</code>-supplied transforming methods such as <code>map()</code>, <code>where()</code>, <code>expand()</code>, and <code>take()</code>.</p><p>For example, assume you have a stream, <code>counterStream</code>, that emits an increasing counter every second. Here's how it might be implemented:</p> <?code-excerpt "misc/lib/articles/creating-streams/stream_controller.dart (basic-usage)"?> <div class="code-block-wrapper language-dart"><div class="code-block-body"><span class="code-block-language" title="Language dart">dart</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#D43324">var</span><span style="color:#222222"> counterStream =</span></span>
<span class="line"><span style="color:#0468D7">    Stream</span><span style="color:#222222">&#x3C;</span><span style="color:#0468D7">int</span><span style="color:#222222">>.</span><span style="color:#6200EE">periodic</span><span style="color:#222222">(</span><span style="color:#D43324">const</span><span style="color:#0468D7"> Duration</span><span style="color:#222222">(seconds: </span><span style="color:#11796D">1</span><span style="color:#222222">), (x) => x).</span><span style="color:#6200EE">take</span><span style="color:#222222">(</span><span style="color:#11796D">15</span><span style="color:#222222">);</span></span></code></pre></div></div><p>To quickly see the events, you can use code like this:</p> <?code-excerpt "misc/lib/articles/creating-streams/stream_controller.dart (basic-for-each)"?> <div class="code-block-wrapper language-dart"><div class="code-block-body"><span class="code-block-language" title="Language dart">dart</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#222222">counterStream.</span><span style="color:#6200EE">forEach</span><span style="color:#222222">(print); </span><span style="color:#6E6E70">// Print an integer every second, 15 times.</span></span></code></pre></div></div><p>To transform the stream events, you can invoke a transforming method such as <code>map()</code> on the stream before listening to it. The method returns a new stream.</p> <?code-excerpt "misc/lib/articles/creating-streams/stream_controller.dart (use-map)"?> <div class="code-block-wrapper language-dart"><div class="code-block-body"><span class="code-block-language" title="Language dart">dart</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#6E6E70">// Double the integer in each event.</span></span>
<span class="line"><span style="color:#D43324">var</span><span style="color:#222222"> doubleCounterStream = counterStream.</span><span style="color:#6200EE">map</span><span style="color:#222222">((</span><span style="color:#0468D7">int</span><span style="color:#222222"> x) => x * </span><span style="color:#11796D">2</span><span style="color:#222222">);</span></span>
<span class="line"><span style="color:#222222">doubleCounterStream.</span><span style="color:#6200EE">forEach</span><span style="color:#222222">(print);</span></span></code></pre></div></div><p>Instead of <code>map()</code>, you could use any other transforming method, such as the following:</p> <?code-excerpt "misc/lib/articles/creating-streams/stream_controller.dart (use-where)"?> <div class="code-block-wrapper language-dart"><div class="code-block-body"><span class="code-block-language" title="Language dart">dart</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#222222">.</span><span style="color:#6200EE">where</span><span style="color:#222222">((</span><span style="color:#0468D7">int</span><span style="color:#222222"> x) => x.isEven) </span><span style="color:#6E6E70">// Retain only even integer events.</span></span>
<span class="line"><span style="color:#222222">.</span><span style="color:#6200EE">expand</span><span style="color:#222222">((</span><span style="color:#D43324">var</span><span style="color:#222222"> x) => [x, x]) </span><span style="color:#6E6E70">// Duplicate each event.</span></span>
<span class="line"><span style="color:#222222">.</span><span style="color:#6200EE">take</span><span style="color:#222222">(</span><span style="color:#11796D">5</span><span style="color:#222222">) </span><span style="color:#6E6E70">// Stop after the first five events.</span></span></code></pre></div></div><p>Often, a transforming method is all you need. However, if you need even more control over the transformation, you can specify a <a href="https://api.dart.dev/dart-async/StreamTransformer-class.html">StreamTransformer</a> with <code>Stream</code>'s <code>transform()</code> method. The platform libraries provide stream transformers for many common tasks. For example, the following code uses the <code>utf8.decoder</code> and <code>LineSplitter</code> transformers provided by the dart:convert library.</p> <?code-excerpt "misc/lib/articles/creating-streams/stream_controller.dart (use-transform)"?> <div class="code-block-wrapper language-dart"><div class="code-block-body"><span class="code-block-language" title="Language dart">dart</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#0468D7">Stream</span><span style="color:#222222">&#x3C;</span><span style="color:#0468D7">List</span><span style="color:#222222">&#x3C;</span><span style="color:#0468D7">int</span><span style="color:#222222">>> content = </span><span style="color:#0468D7">File</span><span style="color:#222222">(</span><span style="color:#11796D">'someFile.txt'</span><span style="color:#222222">).</span><span style="color:#6200EE">openRead</span><span style="color:#222222">();</span></span>
<span class="line"><span style="color:#0468D7">List</span><span style="color:#222222">&#x3C;</span><span style="color:#0468D7">String</span><span style="color:#222222">> lines = </span><span style="color:#D43324">await</span><span style="color:#222222"> content</span></span>
<span class="line"><span style="color:#222222">    .</span><span style="color:#6200EE">transform</span><span style="color:#222222">(utf8.decoder)</span></span>
<span class="line"><span style="color:#222222">    .</span><span style="color:#6200EE">transform</span><span style="color:#222222">(</span><span style="color:#D43324">const</span><span style="color:#0468D7"> LineSplitter</span><span style="color:#222222">())</span></span>
<span class="line"><span style="color:#222222">    .</span><span style="color:#6200EE">toList</span><span style="color:#222222">();</span></span></code></pre></div></div><div class="header-wrapper"><h2 id="creating-a-stream-from-scratch">Creating a stream from scratch</h2><a class="heading-link" href="#creating-a-stream-from-scratch" aria-label="Link to 'Creating a stream from scratch' section">#</a></div><p>One way to create a new stream is with an asynchronous generator (<code>async*</code>) function. The stream is created when the function is called, and the function's body starts running when the stream is listened to. When the function returns, the stream closes. Until the function returns, it can emit events on the stream by using <code>yield</code> or <code>yield*</code> statements.</p><p>Here's a primitive example that emits numbers at regular intervals:</p> <?code-excerpt "misc/lib/articles/creating-streams/stream_controller.dart (async-generator)" replace="/timedCounterGenerator/timedCounter/g"?> <div class="code-block-wrapper language-dart"><div class="code-block-body"><span class="code-block-language" title="Language dart">dart</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#0468D7">Stream</span><span style="color:#222222">&#x3C;</span><span style="color:#0468D7">int</span><span style="color:#222222">> </span><span style="color:#6200EE">timedCounter</span><span style="color:#222222">(</span><span style="color:#0468D7">Duration</span><span style="color:#222222"> interval, [</span><span style="color:#0468D7">int</span><span style="color:#222222">? maxCount]) </span><span style="color:#D43324">async</span><span style="color:#222222">* {</span></span>
<span class="line"><span style="color:#0468D7">  int</span><span style="color:#222222"> i = </span><span style="color:#11796D">0</span><span style="color:#222222">;</span></span>
<span class="line"><span style="color:#D43324">  while</span><span style="color:#222222"> (</span><span style="color:#11796D">true</span><span style="color:#222222">) {</span></span>
<span class="line"><span style="color:#D43324">    await</span><span style="color:#0468D7"> Future</span><span style="color:#222222">.</span><span style="color:#6200EE">delayed</span><span style="color:#222222">(interval);</span></span>
<span class="line"><span style="color:#D43324">    yield</span><span style="color:#222222"> i++;</span></span>
<span class="line"><span style="color:#D43324">    if</span><span style="color:#222222"> (i == maxCount) </span><span style="color:#D43324">break</span><span style="color:#222222">;</span></span>
<span class="line"><span style="color:#222222">  }</span></span>
<span class="line"><span style="color:#222222">}</span></span></code></pre></div></div><p>This function returns a <code>Stream</code>. When that stream is listened to, the body starts running. It repeatedly delays for the requested interval and then yields the next number. If the <code>maxCount</code> parameter is omitted, there is no stop condition on the loop, so the stream outputs increasingly larger numbers forever - or until the listener cancels its subscription.</p><p>When the listener cancels (by invoking <code>cancel()</code> on the <code>StreamSubscription</code> object returned by the <code>listen()</code> method), then the next time the body reaches a <code>yield</code> statement, the <code>yield</code> instead acts as a <code>return</code> statement. Any enclosing <code>finally</code> block is executed, and the function exits. If the function attempts to yield a value before exiting, that fails and acts as a return.</p><p>When the function finally exits, the future returned by the <code>cancel()</code> method completes. If the function exits with an error, the future completes with that error; otherwise, it completes with <code>null</code>.</p><p>Another, more useful example is a function that converts a sequence of futures to a stream:</p> <?code-excerpt "misc/lib/articles/creating-streams/stream_controller.dart (stream-from-futures)"?> <div class="code-block-wrapper language-dart"><div class="code-block-body"><span class="code-block-language" title="Language dart">dart</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#0468D7">Stream</span><span style="color:#222222">&#x3C;</span><span style="color:#0468D7">T</span><span style="color:#222222">> </span><span style="color:#6200EE">streamFromFutures</span><span style="color:#222222">&#x3C;</span><span style="color:#0468D7">T</span><span style="color:#222222">>(</span><span style="color:#0468D7">Iterable</span><span style="color:#222222">&#x3C;</span><span style="color:#0468D7">Future</span><span style="color:#222222">&#x3C;</span><span style="color:#0468D7">T</span><span style="color:#222222">>> futures) </span><span style="color:#D43324">async</span><span style="color:#222222">* {</span></span>
<span class="line"><span style="color:#D43324">  for</span><span style="color:#222222"> (</span><span style="color:#D43324">final</span><span style="color:#222222"> future </span><span style="color:#D43324">in</span><span style="color:#222222"> futures) {</span></span>
<span class="line"><span style="color:#D43324">    var</span><span style="color:#222222"> result = </span><span style="color:#D43324">await</span><span style="color:#222222"> future;</span></span>
<span class="line"><span style="color:#D43324">    yield</span><span style="color:#222222"> result;</span></span>
<span class="line"><span style="color:#222222">  }</span></span>
<span class="line"><span style="color:#222222">}</span></span></code></pre></div></div><p>This function asks the <code>futures</code> iterable for a new future, waits for that future, emits the resulting value, and then loops. If a future completes with an error, then the stream completes with that error.</p><p>It's rare to have an <code>async*</code> function building a stream from nothing. It needs to get its data from somewhere, and most often that somewhere is another stream. In some cases, like the sequence of futures above, the data comes from other asynchronous event sources. In many cases, however, an <code>async*</code> function is too simplistic to easily handle multiple data sources. That's where the <code>StreamController</code> class comes in.</p><div class="header-wrapper"><h2 id="using-a-streamcontroller">Using a StreamController</h2><a class="heading-link" href="#using-a-streamcontroller" aria-label="Link to 'Using a StreamController' section">#</a></div><p>If the events of your stream comes from different parts of your program, and not just from a stream or futures that can traversed by an <code>async</code> function, then use a <a href="https://api.dart.dev/dart-async/StreamController-class.html">StreamController</a> to create and populate the stream.</p><p>A <code>StreamController</code> gives you a new stream and a way to add events to the stream at any point, and from anywhere. The stream has all the logic necessary to handle listeners and pausing. You return the stream and keep the controller to yourself.</p><p>The following example (from <a href="https://github.com/dart-lang/site-www/blob/main/examples/misc/lib/articles/creating-streams/stream_controller_bad.dart">stream_controller_bad.dart</a>) shows a basic, though flawed, usage of <code>StreamController</code> to implement the <code>timedCounter()</code> function from the previous examples. This code creates a stream to return, and then feeds data into it based on timer events, which are neither futures nor stream events.</p> <?code-excerpt "misc/lib/articles/creating-streams/stream_controller_bad.dart (flawed-stream)"?> <div class="code-block-wrapper language-dart"><div class="code-block-body has-tag tag-bad"><span class="code-block-tag">bad</span><span class="code-block-language" title="Language dart">dart</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#6E6E70">// NOTE: This implementation is FLAWED!</span></span>
<span class="line"><span style="color:#6E6E70">// It starts before it has subscribers, and it doesn't implement pause.</span></span>
<span class="line"><span style="color:#0468D7">Stream</span><span style="color:#222222">&#x3C;</span><span style="color:#0468D7">int</span><span style="color:#222222">> </span><span style="color:#6200EE">timedCounter</span><span style="color:#222222">(</span><span style="color:#0468D7">Duration</span><span style="color:#222222"> interval, [</span><span style="color:#0468D7">int</span><span style="color:#222222">? maxCount]) {</span></span>
<span class="line"><span style="color:#D43324">  var</span><span style="color:#222222"> controller = </span><span style="color:#0468D7">StreamController</span><span style="color:#222222">&#x3C;</span><span style="color:#0468D7">int</span><span style="color:#222222">>();</span></span>
<span class="line"><span style="color:#0468D7">  int</span><span style="color:#222222"> counter = </span><span style="color:#11796D">0</span><span style="color:#222222">;</span></span>
<span class="line"><span style="color:#D43324">  void</span><span style="color:#6200EE"> tick</span><span style="color:#222222">(</span><span style="color:#0468D7">Timer</span><span style="color:#222222"> timer) {</span></span>
<span class="line"><span style="color:#222222">    counter++;</span></span>
<span class="line"><span style="color:#222222">    controller.</span><span style="color:#6200EE">add</span><span style="color:#222222">(counter); </span><span style="color:#6E6E70">// Ask stream to send counter values as event.</span></span>
<span class="line"><span style="color:#D43324">    if</span><span style="color:#222222"> (maxCount != </span><span style="color:#11796D">null</span><span style="color:#222222"> &#x26;&#x26; counter >= maxCount) {</span></span>
<span class="line"><span style="color:#222222">      timer.</span><span style="color:#6200EE">cancel</span><span style="color:#222222">();</span></span>
<span class="line"><span style="color:#222222">      controller.</span><span style="color:#6200EE">close</span><span style="color:#222222">(); </span><span style="color:#6E6E70">// Ask stream to shut down and tell listeners.</span></span>
<span class="line"><span style="color:#222222">    }</span></span>
<span class="line"><span style="color:#222222">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#0468D7">  Timer</span><span style="color:#222222">.</span><span style="color:#6200EE">periodic</span><span style="color:#222222">(interval, tick); </span><span style="color:#6E6E70">// BAD: Starts before it has subscribers.</span></span>
<span class="line"><span style="color:#D43324">  return</span><span style="color:#222222"> controller.stream;</span></span>
<span class="line"><span style="color:#222222">}</span></span></code></pre></div></div><p>As before, you can use the stream returned by <code>timedCounter()</code> like this:</p> <?code-excerpt "misc/lib/articles/creating-streams/stream_controller_bad.dart (using-stream)"?> <div class="code-block-wrapper language-dart"><div class="code-block-body"><span class="code-block-language" title="Language dart">dart</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#D43324">var</span><span style="color:#222222"> counterStream = </span><span style="color:#6200EE">timedCounter</span><span style="color:#222222">(</span><span style="color:#D43324">const</span><span style="color:#0468D7"> Duration</span><span style="color:#222222">(seconds: </span><span style="color:#11796D">1</span><span style="color:#222222">), </span><span style="color:#11796D">15</span><span style="color:#222222">);</span></span>
<span class="line"><span style="color:#222222">counterStream.</span><span style="color:#6200EE">listen</span><span style="color:#222222">(print); </span><span style="color:#6E6E70">// Print an integer every second, 15 times.</span></span></code></pre></div></div><p>This implementation of <code>timedCounter()</code> has a couple of problems:</p><ul><li>It starts producing events before it has subscribers.</li><li>It keeps producing events even if the subscriber requests a pause.</li></ul><p>As the next sections show, you can fix both of these problems by specifying callbacks such as <code>onListen</code> and <code>onPause</code> when creating the <code>StreamController</code>.</p><div class="header-wrapper"><h3 id="waiting-for-a-subscription">Waiting for a subscription</h3><a class="heading-link" href="#waiting-for-a-subscription" aria-label="Link to 'Waiting for a subscription' section">#</a></div><p>As a rule, streams should wait for subscribers before starting their work. An <code>async*</code> function does this automatically, but when using a <code>StreamController</code>, you are in full control and can add events even when you shouldn't. When a stream has no subscriber, its <code>StreamController</code> buffers events, which can lead to a memory leak if the stream never gets a subscriber.</p><p>Try changing the code that uses the stream to the following:</p> <?code-excerpt "misc/lib/articles/creating-streams/stream_controller_bad.dart (pre-subscribe-problem)"?> <div class="code-block-wrapper language-dart"><div class="code-block-body"><span class="code-block-language" title="Language dart">dart</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#D43324">void</span><span style="color:#6200EE"> listenAfterDelay</span><span style="color:#222222">() </span><span style="color:#D43324">async</span><span style="color:#222222"> {</span></span>
<span class="line"><span style="color:#D43324">  var</span><span style="color:#222222"> counterStream = </span><span style="color:#6200EE">timedCounter</span><span style="color:#222222">(</span><span style="color:#D43324">const</span><span style="color:#0468D7"> Duration</span><span style="color:#222222">(seconds: </span><span style="color:#11796D">1</span><span style="color:#222222">), </span><span style="color:#11796D">15</span><span style="color:#222222">);</span></span>
<span class="line"><span style="color:#D43324">  await</span><span style="color:#0468D7"> Future</span><span style="color:#222222">.</span><span style="color:#6200EE">delayed</span><span style="color:#222222">(</span><span style="color:#D43324">const</span><span style="color:#0468D7"> Duration</span><span style="color:#222222">(seconds: </span><span style="color:#11796D">5</span><span style="color:#222222">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6E6E70">  // After 5 seconds, add a listener.</span></span>
<span class="line"><span style="color:#D43324">  await</span><span style="color:#D43324"> for</span><span style="color:#222222"> (</span><span style="color:#D43324">final</span><span style="color:#222222"> n </span><span style="color:#D43324">in</span><span style="color:#222222"> counterStream) {</span></span>
<span class="line"><span style="color:#6200EE">    print</span><span style="color:#222222">(n); </span><span style="color:#6E6E70">// Print an integer every second, 15 times.</span></span>
<span class="line"><span style="color:#222222">  }</span></span>
<span class="line"><span style="color:#222222">}</span></span></code></pre></div></div><p>When this code runs, nothing is printed for the first 5 seconds, although the stream is doing work. Then the listener is added, and the first 5 or so events are printed all at once, since they were buffered by the <code>StreamController</code>.</p><p>To be notified of subscriptions, specify an <code>onListen</code> argument when you create the <code>StreamController</code>. The <code>onListen</code> callback is called when the stream gets its first subscriber. If you specify an <code>onCancel</code> callback, it's called when the controller loses its last subscriber. In the preceding example, <code>Timer.periodic()</code> should move to an <code>onListen</code> handler, as shown in the next section.</p><div class="header-wrapper"><h3 id="honoring-the-pause-state">Honoring the pause state</h3><a class="heading-link" href="#honoring-the-pause-state" aria-label="Link to 'Honoring the pause state' section">#</a></div><p>Avoid producing events when the listener has requested a pause. An <code>async*</code> function automatically pauses at a <code>yield</code> statement while the stream subscription is paused. A <code>StreamController</code>, on the other hand, buffers events during the pause. If the code providing the events doesn't respect the pause, the size of the buffer can grow indefinitely. Also, if the listener stops listening soon after pausing, then the work spent creating the buffer is wasted.</p><p>To see what happens without pause support, try changing the code that uses the stream to the following:</p> <?code-excerpt "misc/lib/articles/creating-streams/stream_controller_bad.dart (pause-problem)"?> <div class="code-block-wrapper language-dart"><div class="code-block-body"><span class="code-block-language" title="Language dart">dart</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#D43324">void</span><span style="color:#6200EE"> listenWithPause</span><span style="color:#222222">() {</span></span>
<span class="line"><span style="color:#D43324">  var</span><span style="color:#222222"> counterStream = </span><span style="color:#6200EE">timedCounter</span><span style="color:#222222">(</span><span style="color:#D43324">const</span><span style="color:#0468D7"> Duration</span><span style="color:#222222">(seconds: </span><span style="color:#11796D">1</span><span style="color:#222222">), </span><span style="color:#11796D">15</span><span style="color:#222222">);</span></span>
<span class="line"><span style="color:#D43324">  late</span><span style="color:#0468D7"> StreamSubscription</span><span style="color:#222222">&#x3C;</span><span style="color:#0468D7">int</span><span style="color:#222222">> subscription;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#222222">  subscription = counterStream.</span><span style="color:#6200EE">listen</span><span style="color:#222222">((</span><span style="color:#0468D7">int</span><span style="color:#222222"> counter) {</span></span>
<span class="line"><span style="color:#6200EE">    print</span><span style="color:#222222">(counter); </span><span style="color:#6E6E70">// Print an integer every second.</span></span>
<span class="line"><span style="color:#D43324">    if</span><span style="color:#222222"> (counter == </span><span style="color:#11796D">5</span><span style="color:#222222">) {</span></span>
<span class="line"><span style="color:#6E6E70">      // After 5 ticks, pause for five seconds, then resume.</span></span>
<span class="line"><span style="color:#222222">      subscription.</span><span style="color:#6200EE">pause</span><span style="color:#222222">(</span><span style="color:#0468D7">Future</span><span style="color:#222222">.</span><span style="color:#6200EE">delayed</span><span style="color:#222222">(</span><span style="color:#D43324">const</span><span style="color:#0468D7"> Duration</span><span style="color:#222222">(seconds: </span><span style="color:#11796D">5</span><span style="color:#222222">)));</span></span>
<span class="line"><span style="color:#222222">    }</span></span>
<span class="line"><span style="color:#222222">  });</span></span>
<span class="line"><span style="color:#222222">}</span></span></code></pre></div></div><p>When the five seconds of pause are up, the events fired during that time are all received at once. That happens because the stream's source doesn't honor pauses and keeps adding events to the stream. So the stream buffers the events, and it then empties its buffer when the stream becomes unpaused.</p><p>The following version of <code>timedCounter()</code> (from <a href="https://github.com/dart-lang/site-www/blob/main/examples/misc/lib/articles/creating-streams/stream_controller.dart">stream_controller.dart</a>) implements pause by using the <code>onListen</code>, <code>onPause</code>, <code>onResume</code>, and <code>onCancel</code> callbacks on the <code>StreamController</code>.</p> <?code-excerpt "misc/lib/articles/creating-streams/stream_controller.dart (better-stream)"?> <div class="code-block-wrapper language-dart"><div class="code-block-body"><span class="code-block-language" title="Language dart">dart</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#0468D7">Stream</span><span style="color:#222222">&#x3C;</span><span style="color:#0468D7">int</span><span style="color:#222222">> </span><span style="color:#6200EE">timedCounter</span><span style="color:#222222">(</span><span style="color:#0468D7">Duration</span><span style="color:#222222"> interval, [</span><span style="color:#0468D7">int</span><span style="color:#222222">? maxCount]) {</span></span>
<span class="line"><span style="color:#D43324">  late</span><span style="color:#0468D7"> StreamController</span><span style="color:#222222">&#x3C;</span><span style="color:#0468D7">int</span><span style="color:#222222">> controller;</span></span>
<span class="line"><span style="color:#0468D7">  Timer</span><span style="color:#222222">? timer;</span></span>
<span class="line"><span style="color:#0468D7">  int</span><span style="color:#222222"> counter = </span><span style="color:#11796D">0</span><span style="color:#222222">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D43324">  void</span><span style="color:#6200EE"> tick</span><span style="color:#222222">(_) {</span></span>
<span class="line"><span style="color:#222222">    counter++;</span></span>
<span class="line"><span style="color:#222222">    controller.</span><span style="color:#6200EE">add</span><span style="color:#222222">(counter); </span><span style="color:#6E6E70">// Ask stream to send counter values as event.</span></span>
<span class="line"><span style="color:#D43324">    if</span><span style="color:#222222"> (counter == maxCount) {</span></span>
<span class="line"><span style="color:#222222">      timer?.</span><span style="color:#6200EE">cancel</span><span style="color:#222222">();</span></span>
<span class="line"><span style="color:#222222">      controller.</span><span style="color:#6200EE">close</span><span style="color:#222222">(); </span><span style="color:#6E6E70">// Ask stream to shut down and tell listeners.</span></span>
<span class="line"><span style="color:#222222">    }</span></span>
<span class="line"><span style="color:#222222">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D43324">  void</span><span style="color:#6200EE"> startTimer</span><span style="color:#222222">() {</span></span>
<span class="line"><span style="color:#222222">    timer = </span><span style="color:#0468D7">Timer</span><span style="color:#222222">.</span><span style="color:#6200EE">periodic</span><span style="color:#222222">(interval, tick);</span></span>
<span class="line"><span style="color:#222222">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D43324">  void</span><span style="color:#6200EE"> stopTimer</span><span style="color:#222222">() {</span></span>
<span class="line"><span style="color:#222222">    timer?.</span><span style="color:#6200EE">cancel</span><span style="color:#222222">();</span></span>
<span class="line"><span style="color:#222222">    timer = </span><span style="color:#11796D">null</span><span style="color:#222222">;</span></span>
<span class="line"><span style="color:#222222">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#222222">  controller = </span><span style="color:#0468D7">StreamController</span><span style="color:#222222">&#x3C;</span><span style="color:#0468D7">int</span><span style="color:#222222">>(</span></span>
<span class="line"><span style="color:#222222">      onListen: startTimer,</span></span>
<span class="line"><span style="color:#222222">      onPause: stopTimer,</span></span>
<span class="line"><span style="color:#222222">      onResume: startTimer,</span></span>
<span class="line"><span style="color:#222222">      onCancel: stopTimer);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D43324">  return</span><span style="color:#222222"> controller.stream;</span></span>
<span class="line"><span style="color:#222222">}</span></span></code></pre></div></div><p>Run this code with the <code>listenWithPause()</code> function above. You'll see that it stops counting while paused, and it resumes nicely afterwards.</p><p>You must use all of the listeners<code>onListen</code>, <code>onCancel</code>, <code>onPause</code>, and <code>onResume</code>to be notified of changes in pause state. The reason is that if the subscription and pause states both change at the same time, only the <code>onListen</code> or <code>onCancel</code> callback is called.</p><div class="header-wrapper"><h2 id="final-hints">Final hints</h2><a class="heading-link" href="#final-hints" aria-label="Link to 'Final hints' section">#</a></div><p>When creating a stream without using an async* function, keep these tips in mind:</p><ul><li><p>Be careful when using a synchronous controllerfor example, one created using <code>StreamController(sync: true)</code>. When you send an event on an unpaused synchronous controller (for example, using the <code>add()</code>, <code>addError()</code>, or <code>close()</code> methods defined by <a href="https://api.dart.dev/dart-async/EventSink-class.html">EventSink</a>), the event is sent immediately to all listeners on the stream. <code>Stream</code> listeners must never be called until the code that added the listener has fully returned, and using a synchronous controller at the wrong time can break this promise and cause good code to fail. Avoid using synchronous controllers.</p></li><li><p>If you use <code>StreamController</code>, the <code>onListen</code> callback is called before the <code>listen</code> call returns the <code>StreamSubscription</code>. Don't let the <code>onListen</code> callback depend on the subscription already existing. For example, in the following code, an <code>onListen</code> event fires (and <code>handler</code> is called) before the <code>subscription</code> variable has a valid value.</p> <?code-excerpt "misc/lib/articles/creating-streams/stream_controller.dart (stream-listen-hint)"?> <div class="code-block-wrapper language-dart"><div class="code-block-body"><span class="code-block-language" title="Language dart">dart</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#222222">subscription = stream.</span><span style="color:#6200EE">listen</span><span style="color:#222222">(handler);</span></span></code></pre></div></div></li><li><p>The <code>onListen</code>, <code>onPause</code>, <code>onResume</code>, and <code>onCancel</code> callbacks defined by <code>StreamController</code> are called by the stream when the stream's listener state changes, but never during the firing of an event or during the call of another state change handler. In those cases, the state change callback is delayed until the previous callback is complete.</p></li><li><p>Don't try to implement the <code>Stream</code> interface yourself. It's easy to get the interaction between events, callbacks, and adding and removing listeners subtly wrong. Always use an existing stream, possibly from a <code>StreamController</code>, to implement the <code>listen</code> call of a new stream.</p></li><li><p>Although it's possible to create classes that extend <code>Stream</code> with more functionality by extending the <code>Stream</code> class and implementing the <code>listen</code> method and the extra functionality on top, that is generally not recommended because it introduces a new type that users have to consider. Instead of a class that <em>is</em> a <code>Stream</code> (and more), you can often make a class that <em>has</em> a <code>Stream</code> (and more).</p></li></ul><p id="page-github-links"><span>Unless stated otherwise, the documentation on this site reflects Dart 3.6.0. Page last updated on 2021-05-16.</span> <a href="https://github.com/dart-lang/site-www/tree/main/src/content/libraries/async/creating-streams.md" target="_blank" rel="noopener">View source</a> <span>or </span><a href="https://github.com/dart-lang/site-www/issues/new?template=1_page_issue.yml&amp;page-url=https://dart.dev/libraries/async/creating-streams/&amp;page-source=https://github.com/dart-lang/site-www/tree/main/src/content/libraries/async/creating-streams.md" title="Report an issue with this page" target="_blank" rel="noopener">report an issue</a>.</p></div></article></main><footer id="page-footer"><div class="footer-section footer-main"><a href="../../index.html" class="brand" title="Dart"><img src="../../assets/img/logo/logo-white-text.svg" alt="Dart" width="164"></a><div class="footer-social-links"><a href="https://medium.com/dartlang" target="_blank" rel="noopener" title="Medium blog"><svg><use href="../../assets/img/social/medium.svg#medium"></use></svg> </a><a href="https://github.com/dart-lang" target="_blank" rel="noopener" title="GitHub"><svg><use href="../../assets/img/social/github.svg#github"></use></svg> </a><a href="https://twitter.com/dart_lang" target="_blank" rel="noopener" title="X (Twitter)"><svg><use href="../../assets/img/social/x.svg#x"></use></svg></a></div></div><div class="footer-section footer-tray"><div class="footer-licenses">Except as otherwise noted, this site is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>, and code samples are licensed under the <a href="https://opensource.org/licenses/BSD-3-Clause">3-Clause BSD License</a>.</div><div class="footer-utility-links"><ul><li><a href="../../terms.html" title="Terms of use">Terms</a></li><li><a href="https://policies.google.com/privacy" target="_blank" rel="noopener" title="Privacy policy">Privacy</a></li><li><a href="../../security.html" title="Security philosophy and practices">Security</a></li></ul></div></div></footer></body>
<!-- Mirrored from dart.dev/libraries/async/creating-streams by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Dec 2024 22:14:25 GMT -->
</html>