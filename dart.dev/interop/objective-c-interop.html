<!doctype html><html lang="en">
<!-- Mirrored from dart.dev/interop/objective-c-interop by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Dec 2024 22:15:08 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="../../www.googletagmanager.com/gtm4a44.js?id=GTM-5VSZM5J",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script><meta name="description" content="To use Objective-C and Swift code in your Dart program, use package:ffigen."><title>Objective-C and Swift interop using package:ffigen | Dart</title><link rel="icon" sizes="64x64" href="../assets/img/logo/dart-64.png" eleventy:ignore><link href="../assets/img/touch-icon-iphone.png" rel="apple-touch-icon" eleventy:ignore><link href="../assets/img/touch-icon-ipad.png" rel="apple-touch-icon" sizes="152x152" eleventy:ignore><link href="../assets/img/touch-icon-iphone-retina.png" rel="apple-touch-icon" sizes="180x180" eleventy:ignore><link href="../assets/img/touch-icon-ipad-retina.png" rel="apple-touch-icon" sizes="167x167" eleventy:ignore><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@dart_lang"><meta name="twitter:title" content="Objective-C and Swift interop using package:ffigen"><meta name="twitter:description" content="To use Objective-C and Swift code in your Dart program, use package:ffigen."><meta property="og:title" content="Objective-C and Swift interop using package:ffigen"><meta property="og:description" content="To use Objective-C and Swift code in your Dart program, use package:ffigen."><meta property="og:url" content="/interop/objective-c-interop/"><meta property="og:image" content="/assets/img/logo/dart-logo-for-shares.png?2" eleventy:ignore><link rel="preconnect" href="https://fonts.googleapis.com/"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Google+Sans+Display:wght@400&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Google+Sans+Mono:wght@400;500;700&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Google+Sans+Text:wght@400;500;700&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet"><link rel="stylesheet" href="../assets/css/main.css"><script src="../../cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha512-3gJwYpMe3QewGELv8k/BX9vcqhryRdzRMxVfq6ngyWXwo03GFEzjsUm8Q7RZcHPHksttq7/GFoxjCVUjkjvPdw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><script src="../../cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous" referrerpolicy="no-referrer"></script><script src="../../cdnjs.cloudflare.com/ajax/libs/js-cookie/3.0.5/js.cookie.min.js" integrity="sha512-nlp9/l96/EpjYBx7EP7pGASVXNe80hGhYAUrjeXnu/fyF5Py0/RXav4BBNs7n5Hx1WFhOEOWSAVjGeC3oKxDVQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><script src="../assets/js/os-tabs.js"></script><script src="../assets/js/utilities.js"></script><script src="../assets/js/main.js"></script><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src="../../www.google-analytics.com/analytics.js",s.parentNode.insertBefore(o,s)}(window,document,"script",0,"ga"),ga("create","UA-26406144-4","auto"),ga("send","pageview")</script></head><body class="default.html show_banner"><a id="skip" href="#site-content-title">Skip to main content</a><section id="cookie-notice"><div class="container"><p>dart.dev uses cookies from Google to deliver and enhance the quality of its services and to analyze traffic. <a href="https://policies.google.com/technologies/cookies" target="_blank" rel="noopener">Learn more</a>.</p><button id="cookie-consent" class="btn btn-primary">OK, got it</button></div></section><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5VSZM5J" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><header id="page-header" class="site-header"><nav id="mainnav" class="site-header"><div id="menu-toggle"><i class="material-symbols">menu</i></div><a href="../index.html" class="brand" title="Dart"><img src="../assets/img/logo/logo-white-text.svg" alt="Dart"></a><ul class="navbar"><li><a href="../overview.html" class="nav-link">Overview</a></li><li class="mainnav__get-started"><a href="../guides.html" class="nav-link"><span>Docs</span></a></li><li><a href="../community.html" class="nav-link">Community</a></li><li><a href="../index.html#try-dart" class="nav-link">Try Dart</a></li><li><a href="../get-dart.html" class="nav-link">Get Dart</a></li><li class="searchfield"><form action="https://dart.dev/search" class="site-header__search form-inline" id="cse-search-box"><input type="hidden" name="cx" value="011220921317074318178:_yy-tmb5t_i"> <input type="hidden" name="ie" value="UTF-8"> <input type="hidden" name="hl" value="en"> <input class="site-header__searchfield form-control search-field" type="search" name="q" id="search-main" autocomplete="off" placeholder="Search" aria-label="Search"></form></li></ul></nav></header><div class="banner"><p class="banner__text">Dart 3.6 is here! Read the <a href="https://medium.com/dartlang/announcing-dart-3-6-778dd7a80983" target="_blank">blog post</a> to learn about new features in pub and the language.</p></div><div id="sidenav"><form action="https://dart.dev/search/" class="site-header__search form-inline"><input class="site-header__searchfield form-control search-field" type="search" name="q" id="search-side" autocomplete="off" placeholder="Search" aria-label="Search"></form><div class="site-sidebar"><ul class="navbar-nav"><li class="nav-item"><a href="../overview.html" class="nav-link">Overview</a></li><li class="nav-item"><a href="../community.html" class="nav-link">Community</a></li><li class="nav-item"><a href="https://dartpad.dev/" class="nav-link">Try Dart</a></li><li class="nav-item"><a href="../get-dart.html" class="nav-link">Get Dart</a></li><li class="nav-item"><a href="../guides.html" class="nav-link">Docs</a></li><li aria-hidden="true"><div class="sidebar-primary-divider"></div></li></ul><ul class="nav flex-column"><li class="nav-item"><a class="nav-link collapsed collapsible" data-toggle="collapse" href="#sidenav-1" role="button" aria-expanded="false" aria-controls="sidenav-1">Language</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-1"><li class="nav-item"><a class="nav-link" href="../language.html">Introduction</a></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-1-2" href="#sidenav-1-2" role="button" aria-expanded="false" aria-controls="sidenav-1-2">Syntax basics</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-1-2"><li class="nav-item"><a class="nav-link" href="../language/variables.html">Variables</a></li><li class="nav-item"><a class="nav-link" href="../language/operators.html">Operators</a></li><li class="nav-item"><a class="nav-link" href="../language/comments.html">Comments</a></li><li class="nav-item"><a class="nav-link" href="../language/metadata.html">Metadata</a></li><li class="nav-item"><a class="nav-link" href="../language/libraries.html">Libraries & imports</a></li><li class="nav-item"><a class="nav-link" href="../language/keywords.html">Keywords</a></li></ul></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-1-3" href="#sidenav-1-3" role="button" aria-expanded="false" aria-controls="sidenav-1-3">Types</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-1-3"><li class="nav-item"><a class="nav-link" href="../language/built-in-types.html">Built-in types</a></li><li class="nav-item"><a class="nav-link" href="../language/records.html">Records</a></li><li class="nav-item"><a class="nav-link" href="../language/collections.html">Collections</a></li><li class="nav-item"><a class="nav-link" href="../language/generics.html">Generics</a></li><li class="nav-item"><a class="nav-link" href="../language/typedefs.html">Typedefs</a></li><li class="nav-item"><a class="nav-link" href="../language/type-system.html">Type system</a></li></ul></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-1-4" href="#sidenav-1-4" role="button" aria-expanded="false" aria-controls="sidenav-1-4">Patterns</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-1-4"><li class="nav-item"><a class="nav-link" href="../language/patterns.html">Overview & usage</a></li><li class="nav-item"><a class="nav-link" href="../language/pattern-types.html">Pattern types</a></li><li class="nav-item"><a class="nav-link" href="https://codelabs.developers.google.com/codelabs/dart-patterns-records" target="_blank" rel="noopener">Applied tutorial</a></li></ul></li><li class="nav-item"><a class="nav-link" href="../language/functions.html">Functions</a></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-1-6" href="#sidenav-1-6" role="button" aria-expanded="false" aria-controls="sidenav-1-6">Control flow</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-1-6"><li class="nav-item"><a class="nav-link" href="../language/loops.html">Loops</a></li><li class="nav-item"><a class="nav-link" href="../language/branches.html">Branches</a></li><li class="nav-item"><a class="nav-link" href="../language/error-handling.html">Error handling</a></li></ul></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-1-7" href="#sidenav-1-7" role="button" aria-expanded="false" aria-controls="sidenav-1-7">Classes & objects</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-1-7"><li class="nav-item"><a class="nav-link" href="../language/classes.html">Classes</a></li><li class="nav-item"><a class="nav-link" href="../language/constructors.html">Constructors</a></li><li class="nav-item"><a class="nav-link" href="../language/methods.html">Methods</a></li><li class="nav-item"><a class="nav-link" href="../language/extend.html">Extend a class</a></li><li class="nav-item"><a class="nav-link" href="../language/mixins.html">Mixins</a></li><li class="nav-item"><a class="nav-link" href="../language/enums.html">Enums</a></li><li class="nav-item"><a class="nav-link" href="../language/extension-methods.html">Extension methods</a></li><li class="nav-item"><a class="nav-link" href="../language/extension-types.html">Extension types</a></li><li class="nav-item"><a class="nav-link" href="../language/callable-objects.html">Callable objects</a></li></ul></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-1-8" href="#sidenav-1-8" role="button" aria-expanded="false" aria-controls="sidenav-1-8">Class modifiers</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-1-8"><li class="nav-item"><a class="nav-link" href="../language/class-modifiers.html">Overview & usage</a></li><li class="nav-item"><a class="nav-link" href="../language/class-modifiers-for-apis.html">Class modifiers for API maintainers</a></li><li class="nav-item"><a class="nav-link" href="../language/modifier-reference.html">Reference</a></li></ul></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-1-9" href="#sidenav-1-9" role="button" aria-expanded="false" aria-controls="sidenav-1-9">Concurrency</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-1-9"><li class="nav-item"><a class="nav-link" href="../language/concurrency.html">Overview</a></li><li class="nav-item"><a class="nav-link" href="../language/async.html">Asynchronous support</a></li><li class="nav-item"><a class="nav-link" href="../language/isolates.html">Isolates</a></li></ul></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-1-10" href="#sidenav-1-10" role="button" aria-expanded="false" aria-controls="sidenav-1-10">Null safety</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-1-10"><li class="nav-item"><a class="nav-link" href="../null-safety.html">Sound null safety</a></li><li class="nav-item"><a class="nav-link" href="../null-safety/migration-guide.html">Migrating to null safety</a></li><li class="nav-item"><a class="nav-link" href="../null-safety/understanding-null-safety.html">Understanding null safety</a></li><li class="nav-item"><a class="nav-link" href="../null-safety/unsound-null-safety.html">Unsound null safety</a></li><li class="nav-item"><a class="nav-link" href="../null-safety/faq.html">FAQ</a></li></ul></li></ul></li><li class="nav-item"><a class="nav-link collapsed collapsible" data-toggle="collapse" href="#sidenav-2" role="button" aria-expanded="false" aria-controls="sidenav-2">Core libraries</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-2"><li class="nav-item"><a class="nav-link" href="../libraries.html">Overview</a></li><li class="nav-item"><a class="nav-link" href="../libraries/dart-core.html">dart:core</a></li><li class="nav-item"><a class="nav-link" href="../libraries/dart-async.html">dart:async</a></li><li class="nav-item"><a class="nav-link" href="../libraries/dart-math.html">dart:math</a></li><li class="nav-item"><a class="nav-link" href="../libraries/dart-convert.html">dart:convert</a></li><li class="nav-item"><a class="nav-link" href="../libraries/dart-io.html">dart:io</a></li><li class="nav-item"><a class="nav-link" href="../libraries/dart-html.html">dart:html</a></li><div class="dropdown-divider"></div><li class="nav-item"><a class="nav-link" href="../libraries/collections/iterables.html">Iterable collections</a></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-2-10" href="#sidenav-2-10" role="button" aria-expanded="false" aria-controls="sidenav-2-10">Asynchronous programming</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-2-10"><li class="nav-item"><a class="nav-link" href="../libraries/async/async-await.html">Tutorial</a></li><li class="nav-item"><a class="nav-link" href="../libraries/async/futures-error-handling.html">Futures and error handling</a></li><li class="nav-item"><a class="nav-link" href="../libraries/async/using-streams.html">Using streams</a></li><li class="nav-item"><a class="nav-link" href="../libraries/async/creating-streams.html">Creating streams</a></li></ul></li></ul></li><li class="nav-item"><a class="nav-link collapsed collapsible" data-toggle="collapse" href="#sidenav-3" role="button" aria-expanded="false" aria-controls="sidenav-3">Effective Dart</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-3"><li class="nav-item"><a class="nav-link" href="../effective-dart.html">Overview</a></li><li class="nav-item"><a class="nav-link" href="../effective-dart/style.html">Style</a></li><li class="nav-item"><a class="nav-link" href="../effective-dart/documentation.html">Documentation</a></li><li class="nav-item"><a class="nav-link" href="../effective-dart/usage.html">Usage</a></li><li class="nav-item"><a class="nav-link" href="../effective-dart/design.html">Design</a></li></ul></li><li class="nav-item"><a class="nav-link collapsed collapsible" data-toggle="collapse" href="#sidenav-4" role="button" aria-expanded="false" aria-controls="sidenav-4">Packages</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-4"><li class="nav-item"><a class="nav-link" href="../tools/pub/packages.html">How to use packages</a></li><li class="nav-item"><a class="nav-link" href="../resources/useful-packages.html">Commonly used packages</a></li><li class="nav-item"><a class="nav-link" href="../tools/pub/create-packages.html">Creating packages</a></li><li class="nav-item"><a class="nav-link" href="../tools/pub/publishing.html">Publishing packages</a></li><li class="nav-item"><a class="nav-link" href="../tools/pub/writing-package-pages.html">Writing package pages</a></li><li class="nav-item"><a class="nav-link" href="../tools/pub/workspaces.html">Workspaces (monorepo support)</a></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-4-7" href="#sidenav-4-7" role="button" aria-expanded="false" aria-controls="sidenav-4-7">Package reference</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-4-7"><li class="nav-item"><a class="nav-link" href="../tools/pub/dependencies.html">Dependencies</a></li><li class="nav-item"><a class="nav-link" href="../tools/pub/glossary.html">Glossary</a></li><li class="nav-item"><a class="nav-link" href="../tools/pub/package-layout.html">Package layout conventions</a></li><li class="nav-item"><a class="nav-link" href="../tools/pub/environment-variables.html">Pub environment variables</a></li><li class="nav-item"><a class="nav-link" href="../tools/pub/pubspec.html">Pubspec file</a></li><li class="nav-item"><a class="nav-link" href="../tools/pub/troubleshoot.html">Troubleshooting pub</a></li><li class="nav-item"><a class="nav-link" href="../tools/pub/verified-publishers.html">Verified publishers</a></li><li class="nav-item"><a class="nav-link" href="../tools/pub/security-advisories.html">Security advisories</a></li><li class="nav-item"><a class="nav-link" href="../tools/pub/versioning.html">Versioning</a></li><li class="nav-item"><a class="nav-link" href="../tools/pub/custom-package-repositories.html">Custom package repositories</a></li></ul></li><li class="nav-item"><a class="nav-link" href="../tools/pub/private-files.html">What not to commit</a></li></ul></li><li class="nav-item"><a class="nav-link collapsed collapsible" data-toggle="collapse" href="#sidenav-5" role="button" aria-expanded="false" aria-controls="sidenav-5">Development</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-5"><li class="nav-item"><a class="nav-link" href="../guides/json.html">JSON</a></li><li class="nav-item"><a class="nav-link" href="../resources/language/number-representation.html">Number representation</a></li><li class="nav-item"><a class="nav-link" href="../resources/google-apis.html">Google APIs</a></li><li class="nav-item"><a class="nav-link" href="../multiplatform-apps.html">Multi-platform apps</a></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-5-5" href="#sidenav-5-5" role="button" aria-expanded="false" aria-controls="sidenav-5-5">Command-line & server apps</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-5-5"><li class="nav-item"><a class="nav-link" href="../server.html">Overview</a></li><li class="nav-item"><a class="nav-link" href="../tutorials/server/get-started.html">Get started</a></li><li class="nav-item"><a class="nav-link" href="../tutorials/server/cmdline.html">Write command-line apps</a></li><li class="nav-item"><a class="nav-link" href="../tutorials/server/fetch-data.html">Fetch data from the internet</a></li><li class="nav-item"><a class="nav-link" href="../tutorials/server/httpserver.html">Write HTTP servers</a></li><li class="nav-item"><a class="nav-link" href="../server/libraries.html">Libraries & packages</a></li><li class="nav-item"><a class="nav-link" href="../server/google-cloud.html">Google Cloud</a></li></ul></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-5-6" href="#sidenav-5-6" role="button" aria-expanded="false" aria-controls="sidenav-5-6">Web apps</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-5-6"><li class="nav-item"><a class="nav-link" href="../web.html">Overview</a></li><li class="nav-item"><a class="nav-link" href="../web/get-started.html">Get started</a></li><li class="nav-item"><a class="nav-link" href="../web/deployment.html">Deployment</a></li><li class="nav-item"><a class="nav-link" href="../web/libraries.html">Libraries & packages</a></li><li class="nav-item"><a class="nav-link" href="../web/wasm.html">Wasm compilation</a></li></ul></li><li class="nav-item"><a class="nav-link" href="../guides/environment-declarations.html">Environment declarations</a></li></ul></li><li class="nav-item"><a class="nav-link active collapsible" data-toggle="collapse" href="#sidenav-6" role="button" aria-expanded="true" aria-controls="sidenav-6">Interoperability</a><ul class="nav flex-column flex-nowrap collapse show" id="sidenav-6"><li class="nav-item"><a class="nav-link" href="c-interop.html">C interop</a></li><li class="nav-item"><a class="nav-link active" href="objective-c-interop.html">Objective-C & Swift interop</a></li><li class="nav-item"><a class="nav-link" href="java-interop.html">Java & Kotlin interop</a></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-6-4" href="#sidenav-6-4" role="button" aria-expanded="false" aria-controls="sidenav-6-4">JavaScript interop</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-6-4"><li class="nav-item"><a class="nav-link" href="js-interop.html">Overview</a></li><li class="nav-item"><a class="nav-link" href="js-interop/usage.html">Usage</a></li><li class="nav-item"><a class="nav-link" href="js-interop/js-types.html">JS types</a></li><li class="nav-item"><a class="nav-link" href="js-interop/tutorials.html">Tutorials</a></li><li class="nav-item"><a class="nav-link" href="js-interop/past-js-interop.html">Past JS interop</a></li><div class="dropdown-divider"></div><li class="nav-item"><a class="nav-link" href="js-interop/package-web.html">Web interop</a></li></ul></li></ul></li><li class="nav-item"><a class="nav-link collapsed collapsible" data-toggle="collapse" href="#sidenav-7" role="button" aria-expanded="false" aria-controls="sidenav-7">Tools & techniques</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-7"><li class="nav-item"><a class="nav-link" href="../tools.html">Overview</a></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-7-2" href="#sidenav-7-2" role="button" aria-expanded="false" aria-controls="sidenav-7-2">Editors & debuggers</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-7-2"><li class="nav-item"><a class="nav-link" href="../tools/jetbrains-plugin.html">IntelliJ & Android Studio</a></li><li class="nav-item"><a class="nav-link" href="../tools/vs-code.html">VS Code</a></li><li class="nav-item"><a class="nav-link" href="../tools/dart-devtools.html">Dart DevTools</a></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-7-2-4" href="#sidenav-7-2-4" role="button" aria-expanded="false" aria-controls="sidenav-7-2-4">DartPad</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-7-2-4"><li class="nav-item"><a class="nav-link" href="../tools/dartpad.html">Overview</a></li><li class="nav-item"><a class="nav-link" href="../tools/dartpad/troubleshoot.html">Troubleshooting DartPad</a></li></ul></li></ul></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-7-3" href="#sidenav-7-3" role="button" aria-expanded="false" aria-controls="sidenav-7-3">Command-line tools</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-7-3"><li class="nav-item"><a class="nav-link collapsible" data-toggle="collapse" data-target="#sidenav-7-3-1" href="#sidenav-7-3-1" role="button" aria-expanded="true" aria-controls="sidenav-7-3-1">Dart SDK</a><ul class="nav flex-column flex-nowrap collapse show" id="sidenav-7-3-1"><li class="nav-item"><a class="nav-link" href="../tools/sdk.html">Overview</a></li><li class="nav-item"><a class="nav-link" href="../tools/dart-tool.html">dart</a></li><li class="nav-item"><a class="nav-link" href="../tools/dart-analyze.html">dart analyze</a></li><li class="nav-item"><a class="nav-link" href="../tools/dart-compile.html">dart compile</a></li><li class="nav-item"><a class="nav-link" href="../tools/dart-create.html">dart create</a></li><li class="nav-item"><a class="nav-link" href="../tools/dart-doc.html">dart doc</a></li><li class="nav-item"><a class="nav-link" href="../tools/dart-fix.html">dart fix</a></li><li class="nav-item"><a class="nav-link" href="../tools/dart-format.html">dart format</a></li><li class="nav-item"><a class="nav-link" href="../tools/dart-info.html">dart info</a></li><li class="nav-item"><a class="nav-link" href="../tools/pub/cmd.html">dart pub</a></li><li class="nav-item"><a class="nav-link" href="../tools/dart-run.html">dart run</a></li><li class="nav-item"><a class="nav-link" href="../tools/dart-test.html">dart test</a></li><li class="nav-item"><a class="nav-link" href="../tools/dartaotruntime.html">dartaotruntime</a></li><li class="nav-item"><a class="nav-link" href="../tools/experiment-flags.html">Experiment flags</a></li></ul></li><li class="nav-item"><a class="nav-link collapsible" data-toggle="collapse" data-target="#sidenav-7-3-2" href="#sidenav-7-3-2" role="button" aria-expanded="true" aria-controls="sidenav-7-3-2">Other command-line tools</a><ul class="nav flex-column flex-nowrap collapse show" id="sidenav-7-3-2"><li class="nav-item"><a class="nav-link" href="../tools/build_runner.html">build_runner</a></li><li class="nav-item"><a class="nav-link" href="../tools/webdev.html">webdev</a></li></ul></li></ul></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-7-4" href="#sidenav-7-4" role="button" aria-expanded="false" aria-controls="sidenav-7-4">Static analysis</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-7-4"><li class="nav-item"><a class="nav-link" href="../tools/analysis.html">Customizing static analysis</a></li><li class="nav-item"><a class="nav-link" href="../deprecated/sound-problems.html">Fixing common type problems</a></li><li class="nav-item"><a class="nav-link" href="../tools/non-promotion-reasons.html">Fixing type promotion failures</a></li><li class="nav-item"><a class="nav-link" href="../tools/linter-rules.html">Linter rules</a></li><li class="nav-item"><a class="nav-link" href="../tools/diagnostic-messages.html">Diagnostic messages</a></li></ul></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-7-5" href="#sidenav-7-5" role="button" aria-expanded="false" aria-controls="sidenav-7-5">Testing & optimization</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-7-5"><li class="nav-item"><a class="nav-link" href="../guides/testing.html">Testing</a></li><li class="nav-item"><a class="nav-link" href="../web/debugging.html">Debugging web apps</a></li></ul></li></ul></li><li aria-hidden="true"><div class="sidebar-primary-divider"></div></li><li class="nav-item"><a class="nav-link collapsed collapsible" data-toggle="collapse" href="#sidenav-9" role="button" aria-expanded="false" aria-controls="sidenav-9">Resources</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-9"><li class="nav-item"><a class="nav-link" href="../resources/dart-cheatsheet.html">Language cheatsheet</a></li><li class="nav-item"><a class="nav-link" href="../resources/breaking-changes.html">Breaking changes</a></li><li class="nav-item"><a class="nav-link" href="../resources/language/evolution.html">Language evolution</a></li><li class="nav-item"><a class="nav-link" href="../resources/language/spec.html">Language specification</a></li><li class="nav-item"><a class="nav-link" href="../resources/dart-3-migration.html">Dart 3 migration guide</a></li><li class="nav-item"><a class="nav-link collapsible collapsed" data-toggle="collapse" data-target="#sidenav-9-6" href="#sidenav-9-6" role="button" aria-expanded="false" aria-controls="sidenav-9-6">Coming from ...</a><ul class="nav flex-column flex-nowrap collapse" id="sidenav-9-6"><li class="nav-item"><a class="nav-link" href="../resources/coming-from/js-to-dart.html">JavaScript to Dart</a></li><li class="nav-item"><a class="nav-link" href="../resources/coming-from/swift-to-dart.html">Swift to Dart</a></li></ul></li><div class="dropdown-divider"></div><li class="nav-item"><a class="nav-link" href="../resources/faq.html">FAQ</a></li><li class="nav-item"><a class="nav-link" href="../resources/glossary.html">Glossary</a></li><li class="nav-item"><a class="nav-link" href="../resources/books.html">Books</a></li><li class="nav-item"><a class="nav-link" href="../resources/videos.html">Videos</a></li><li class="nav-item"><a class="nav-link" href="../tutorials.html">Tutorials</a></li></ul></li><li class="nav-item"><a class="nav-link collapsible" data-toggle="collapse" href="#sidenav-10" role="button" aria-expanded="true" aria-controls="sidenav-10">Related sites</a><ul class="nav flex-column flex-nowrap collapse show" id="sidenav-10"><li class="nav-item"><a class="nav-link" href="https://api.dart.dev/" target="_blank" rel="noopener">API reference</a></li><li class="nav-item"><a class="nav-link" href="https://medium.com/dartlang" target="_blank" rel="noopener">Blog</a></li><li class="nav-item"><a class="nav-link" href="https://dartpad.dev/" target="_blank" rel="noopener">DartPad (online editor)</a></li><li class="nav-item"><a class="nav-link" href="https://flutter.dev/" target="_blank" rel="noopener">Flutter</a></li><li class="nav-item"><a class="nav-link" href="https://pub.dev/" target="_blank" rel="noopener">Package site</a></li></ul></li></ul></div></div><main id="page-content"><div id="site-toc--side" class="site-toc"><header class="site-toc__title">Contents</header><ul class="section-nav"><li class="toc-entry nav-item"><a class="nav-link" href="#objective-c-example">Objective-C Example</a><ul class="nav"><li class="toc-entry nav-item"><a class="nav-link" href="#configuring-ffigen">Configuring ffigen</a></li><li class="toc-entry nav-item"><a class="nav-link" href="#generating-the-dart-bindings">Generating the Dart bindings</a></li><li class="toc-entry nav-item"><a class="nav-link" href="#using-the-bindings">Using the bindings</a></li><li class="toc-entry nav-item"><a class="nav-link" href="#callbacks-and-multithreading-limitations">Callbacks and multithreading limitations</a></li></ul></li><li class="toc-entry nav-item"><a class="nav-link" href="#swift-example">Swift example</a><ul class="nav"><li class="toc-entry nav-item"><a class="nav-link" href="#generating-the-objective-c-wrapper-header">Generating the Objective-C wrapper header</a></li><li class="toc-entry nav-item"><a class="nav-link" href="#configuring-ffigen-1">Configuring ffigen</a></li><li class="toc-entry nav-item"><a class="nav-link" href="#generating-the-dart-bindings-1">Generating the Dart bindings</a></li><li class="toc-entry nav-item"><a class="nav-link" href="#using-the-bindings-1">Using the bindings</a></li></ul></li></ul></div><article><div class="content"><div id="site-content-title"><h1>Objective-C and Swift interop using package:ffigen</h1></div><div id="site-toc--inline" class="site-toc"><header class="site-toc__title">Contents</header><ul class="section-nav"><li class="toc-entry"><a href="#objective-c-example">Objective-C Example</a><ul><li class="toc-entry"><a href="#configuring-ffigen">Configuring ffigen</a></li><li class="toc-entry"><a href="#generating-the-dart-bindings">Generating the Dart bindings</a></li><li class="toc-entry"><a href="#using-the-bindings">Using the bindings</a></li><li class="toc-entry"><a href="#callbacks-and-multithreading-limitations">Callbacks and multithreading limitations</a></li></ul></li><li class="toc-entry"><a href="#swift-example">Swift example</a><ul><li class="toc-entry"><a href="#generating-the-objective-c-wrapper-header">Generating the Objective-C wrapper header</a></li><li class="toc-entry"><a href="#configuring-ffigen-1">Configuring ffigen</a></li><li class="toc-entry"><a href="#generating-the-dart-bindings-1">Generating the Dart bindings</a></li><li class="toc-entry"><a href="#using-the-bindings-1">Using the bindings</a></li></ul></li></ul></div><p>Dart mobile, command-line, and server apps running on the <a href="../overview.html#platform">Dart Native platform</a>, on macOS or iOS, can use <code>dart:ffi</code> and <a href="https://pub.dev/packages/ffigen"><code>package:ffigen</code></a> to call Objective-C and Swift APIs.</p><aside class="alert alert-info"><div class="alert-header"><i class="material-symbols" aria-hidden="true">info</i> <span>Note</span></div><div class="alert-content"><p>This interop feature is <strong>experimental</strong>, and <a href="https://github.com/dart-lang/sdk/issues/49673">in active development</a>.</p></div></aside><p><code>dart:ffi</code> enables Dart code to interact with native C APIs. Objective-C is based on and compatible with C, so it is possible to interact with Objective-C APIs using only <code>dart:ffi</code>. However, doing so involves a lot of boilerplate code, so you can use <code>package:ffigen</code> to automatically generate the Dart FFI bindings for a given Objective-C API. To learn more about FFI and interfacing with C code directly, see the <a href="c-interop.html">C interop guide</a>.</p><p>You can generate Objective-C headers for Swift APIs, enabling <code>dart:ffi</code> and <code>package:ffigen</code> to interact with Swift.</p><div class="header-wrapper"><h2 id="objective-c-example">Objective-C Example</h2><a class="heading-link" href="#objective-c-example" aria-label="Link to 'Objective-C Example' section">#</a></div><p>This guide walks you through <a href="https://github.com/dart-lang/native/tree/main/pkgs/ffigen/example/objective_c">an example</a> that uses <code>package:ffigen</code> to generate bindings for <a href="https://developer.apple.com/documentation/avfaudio/avaudioplayer?language=objc"><code>AVAudioPlayer</code></a>. This API requires at least macOS SDK 10.7, so check your version and update Xcode if necessary:</p><div class="code-block-wrapper language-console"><div class="code-block-body"><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#222222">$ xcodebuild -showsdks</span></span></code></pre></div></div><p>Generating bindings to wrap an Objective-C API is similar to wrapping a C API. Direct <code>package:ffigen</code> at the header file that describes the API, and then load the library with <code>dart:ffi</code>.</p><p><code>package:ffigen</code> parses Objective-C header files using <a href="https://llvm.org/">LLVM</a>, so you'll need to install that first. See <a href="https://pub.dev/packages/ffigen#installing-llvm">Installing LLVM</a> from the ffigen README for more details.</p><div class="header-wrapper"><h3 id="configuring-ffigen">Configuring ffigen</h3><a class="heading-link" href="#configuring-ffigen" aria-label="Link to 'Configuring ffigen' section">#</a></div><p>First, add <code>package:ffigen</code> as a dev dependency:</p><div class="code-block-wrapper language-console"><div class="code-block-body"><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#222222">$ dart pub add --dev ffigen</span></span></code></pre></div></div><p>Then, configure ffigen to generate bindings for the Objective-C header containing the API. The ffigen configuration options go in your <code>pubspec.yaml</code> file, under a top-level <code>ffigen</code> entry. Alternatively, you can put the ffigen config in its own <code>.yaml</code> file.</p><div class="code-block-wrapper language-yaml"><div class="code-block-body"><span class="code-block-language" title="Language yaml">yaml</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#0468D7">ffigen</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#0468D7">  name</span><span style="color:#222222">: </span><span style="color:#11796D">AVFAudio</span></span>
<span class="line"><span style="color:#0468D7">  description</span><span style="color:#222222">: </span><span style="color:#11796D">Bindings for AVFAudio.</span></span>
<span class="line"><span style="color:#0468D7">  language</span><span style="color:#222222">: </span><span style="color:#11796D">objc</span></span>
<span class="line"><span style="color:#0468D7">  output</span><span style="color:#222222">: </span><span style="color:#11796D">'avf_audio_bindings.dart'</span></span>
<span class="line"><span style="color:#0468D7">  headers</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#0468D7">    entry-points</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#222222">      - </span><span style="color:#11796D">'/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/System/Library/Frameworks/AVFAudio.framework/Headers/AVAudioPlayer.h'</span></span></code></pre></div></div><p>The <code>name</code> is the name of the native library wrapper class that will be generated, and the <code>description</code> will be used in the documentation for that class. The <code>output</code> is the path of the Dart file that ffigen will create. The entry point is the header file containing the API. In this example, it is the internal <code>AVAudioPlayer.h</code> header.</p><p>Another import thing you'll see, if you look at the <a href="https://github.com/dart-lang/native/tree/main/pkgs/ffigen/example/objective_c/pubspec.yaml">example config</a>, is the exclude and include options. By default, <code>ffigen</code> generates bindings for everything it finds in the header, and everything that those bindings depend on in other headers. Most Objective-C libraries depend on Apple's internal libraries, which are very large. If bindings are generated without any filters, the resulting file can be millions of lines long. To solve this problem, the ffigen config has fields that enable you to filter out all the functions, structs, enums, etc., that you're not interested in. For this example, we're only interested in <code>AVAudioPlayer</code>, so you can exclude everything else:</p><div class="code-block-wrapper language-yaml"><div class="code-block-body"><span class="code-block-language" title="Language yaml">yaml</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#0468D7">  exclude-all-by-default</span><span style="color:#222222">: </span><span style="color:#11796D">true</span></span>
<span class="line"><span style="color:#0468D7">  objc-interfaces</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#0468D7">    include</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#222222">      - </span><span style="color:#11796D">'AVAudioPlayer'</span></span></code></pre></div></div><p>Since <code>AVAudioPlayer</code> is explicitly included like this, <code>ffigen</code> excludes all other interfaces. The <code>exclude-all-by-default</code> flag tells <code>ffigen</code> to exclude everything else. The result is that nothing is included except <code>AVAudioPlayer</code>, and its dependencies, such as <code>NSObject</code> and <code>NSString</code>. So instead of several million lines of bindings, you end up with tens of thousands.</p><p>If you need more granular control, you can exclude or include all declarations individually, rather than using <code>exclude-all-by-default</code>:</p><div class="code-block-wrapper language-yaml"><div class="code-block-body"><span class="code-block-language" title="Language yaml">yaml</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#0468D7">  functions</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#0468D7">    exclude</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#222222">      - </span><span style="color:#11796D">'.*'</span></span>
<span class="line"><span style="color:#0468D7">  structs</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#0468D7">    exclude</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#222222">      - </span><span style="color:#11796D">'.*'</span></span>
<span class="line"><span style="color:#0468D7">  unions</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#0468D7">    exclude</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#222222">      - </span><span style="color:#11796D">'.*'</span></span>
<span class="line"><span style="color:#0468D7">  globals</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#0468D7">    exclude</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#222222">      - </span><span style="color:#11796D">'.*'</span></span>
<span class="line"><span style="color:#0468D7">  macros</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#0468D7">    exclude</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#222222">      - </span><span style="color:#11796D">'.*'</span></span>
<span class="line"><span style="color:#0468D7">  enums</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#0468D7">    exclude</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#222222">      - </span><span style="color:#11796D">'.*'</span></span>
<span class="line"><span style="color:#0468D7">  unnamed-enums</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#0468D7">    exclude</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#222222">      - </span><span style="color:#11796D">'.*'</span></span></code></pre></div></div><p>These <code>exclude</code> entries all exclude the regular expression <code>'.*'</code>, which matches anything.</p><p>You can also use the <code>preamble</code> option to insert text at the top of the generated file. In this example, the <code>preamble</code> was used to insert some linter ignore rules at the top of the generated file:</p><div class="code-block-wrapper language-yaml"><div class="code-block-body"><span class="code-block-language" title="Language yaml">yaml</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#0468D7">  preamble</span><span style="color:#222222">: </span><span style="color:#D43324">|</span></span>
<span class="line"><span style="color:#11796D">    // ignore_for_file: camel_case_types, non_constant_identifier_names, unused_element, unused_field, return_of_invalid_type, void_checks, annotate_overrides, no_leading_underscores_for_local_identifiers, library_private_types_in_public_api</span></span></code></pre></div></div><p>See the <a href="https://pub.dev/packages/ffigen#configurations">ffigen readme</a> for a full list of configuration options.</p><div class="header-wrapper"><h3 id="generating-the-dart-bindings">Generating the Dart bindings</h3><a class="heading-link" href="#generating-the-dart-bindings" aria-label="Link to 'Generating the Dart bindings' section">#</a></div><p>To generate the bindings, navigate to the example directory, and run ffigen:</p><div class="code-block-wrapper language-console"><div class="code-block-body"><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#222222">$ dart run ffigen</span></span></code></pre></div></div><p>This will search in the <code>pubspec.yaml</code> file for a top-level <code>ffigen</code> entry. If you chose to put the ffigen config in a separate file, use the <code>--config</code> option and specify that file:</p><div class="code-block-wrapper language-console"><div class="code-block-body"><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#222222">$ dart run ffigen --config my_ffigen_config.yaml</span></span></code></pre></div></div><p>For this example, this will generate <a href="https://github.com/dart-lang/native/tree/main/pkgs/ffigen/example/objective_c/avf_audio_bindings.dart">avf_audio_bindings.dart</a>.</p><p>This file contains a class called <code>AVFAudio</code>, which is the native library wrapper that loads all the API functions using FFI, and provides convenient wrapper methods to call them. The other classes in this file are all Dart wrappers around the Objective-C interfaces that we need, such as <code>AVAudioPlayer</code> and its dependencies.</p><div class="header-wrapper"><h3 id="using-the-bindings">Using the bindings</h3><a class="heading-link" href="#using-the-bindings" aria-label="Link to 'Using the bindings' section">#</a></div><p>Now you're ready to load and interact with the generated library. The example app, <a href="https://github.com/dart-lang/native/tree/main/pkgs/ffigen/example/objective_c/play_audio.dart">play_audio.dart</a>, loads and plays audio files passed as command line arguments. The first step is to load the <a href="https://developer.apple.com/documentation/avfaudio?language=objc">dylib</a> and instantiate the native <code>AVFAudio</code> library:</p><div class="code-block-wrapper language-dart"><div class="code-block-body"><span class="code-block-language" title="Language dart">dart</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#D43324">import</span><span style="color:#11796D"> 'dart:ffi'</span><span style="color:#222222">;</span></span>
<span class="line"><span style="color:#D43324">import</span><span style="color:#11796D"> 'avf_audio_bindings.dart'</span><span style="color:#222222">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D43324">const</span><span style="color:#222222"> _dylibPath =</span></span>
<span class="line"><span style="color:#11796D">    '/System/Library/Frameworks/AVFAudio.framework/Versions/Current/AVFAudio'</span><span style="color:#222222">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D43324">void</span><span style="color:#6200EE"> main</span><span style="color:#222222">(</span><span style="color:#0468D7">List</span><span style="color:#222222">&#x3C;</span><span style="color:#0468D7">String</span><span style="color:#222222">> args) </span><span style="color:#D43324">async</span><span style="color:#222222"> {</span></span>
<span class="line"><span style="color:#D43324">  final</span><span style="color:#222222"> lib = </span><span style="color:#0468D7">AVFAudio</span><span style="color:#222222">(</span><span style="color:#0468D7">DynamicLibrary</span><span style="color:#222222">.</span><span style="color:#6200EE">open</span><span style="color:#222222">(_dylibPath));</span></span></code></pre></div></div><p>Since you're loading an internal library, the dylib path is pointing at an internal framework dylib. You can also load your own <code>.dylib</code> file, or if the library is statically linked into your app (often the case on iOS) you can use <a href="https://api.dart.dev/dart-ffi/DynamicLibrary/DynamicLibrary.process.html"><code>DynamicLibrary.process()</code></a>:</p><div class="code-block-wrapper language-dart"><div class="code-block-body"><span class="code-block-language" title="Language dart">dart</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#D43324">  final</span><span style="color:#222222"> lib = </span><span style="color:#0468D7">AVFAudio</span><span style="color:#222222">(</span><span style="color:#0468D7">DynamicLibrary</span><span style="color:#222222">.</span><span style="color:#6200EE">process</span><span style="color:#222222">());</span></span></code></pre></div></div><p>The goal of the example is to play each of the audio files specified as command line arguments one by one. For each argument, you first have to convert the Dart <code>String</code> to an Objective-C <code>NSString</code>. The generated <code>NSString</code> wrapper has a convenient constructor that handles this conversion, and a <code>toString()</code> method that converts it back to a Dart <code>String</code>.</p><div class="code-block-wrapper language-dart"><div class="code-block-body"><span class="code-block-language" title="Language dart">dart</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#D43324">  for</span><span style="color:#222222"> (</span><span style="color:#D43324">final</span><span style="color:#222222"> file </span><span style="color:#D43324">in</span><span style="color:#222222"> args) {</span></span>
<span class="line"><span style="color:#D43324">    final</span><span style="color:#222222"> fileStr = </span><span style="color:#0468D7">NSString</span><span style="color:#222222">(lib, file);</span></span>
<span class="line"><span style="color:#6200EE">    print</span><span style="color:#222222">(</span><span style="color:#11796D">'Loading </span><span style="color:#11796D">$</span><span style="color:#222222">fileStr</span><span style="color:#11796D">'</span><span style="color:#222222">);</span></span></code></pre></div></div><p>The audio player expects an <code>NSURL</code>, so next we use the <a href="https://developer.apple.com/documentation/foundation/nsurl/1410828-fileurlwithpath?language=objc"><code>fileURLWithPath:</code></a> method to convert the <code>NSString</code> to an <code>NSURL</code>. Since <code>:</code> is not a valid character in a Dart method name, it has been translated to <code>_</code> in the bindings.</p><div class="code-block-wrapper language-dart"><div class="code-block-body"><span class="code-block-language" title="Language dart">dart</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#D43324">    final</span><span style="color:#222222"> fileUrl = </span><span style="color:#0468D7">NSURL</span><span style="color:#222222">.</span><span style="color:#6200EE">fileURLWithPath_</span><span style="color:#222222">(lib, fileStr);</span></span></code></pre></div></div><p>Now, you can construct the <code>AVAudioPlayer</code>. Constructing an Objective-C object has two stages. <code>alloc</code> allocates the memory for the object, but doesn't initialize it. Methods with names starting with <code>init*</code> do the initialization. Some interfaces also provide <code>new*</code> methods that do both of these steps.</p><p>To initialize the <code>AVAudioPlayer</code>, use the <a href="https://developer.apple.com/documentation/avfaudio/avaudioplayer/1387281-initwithcontentsofurl?language=objc"><code>initWithContentsOfURL:error:</code></a> method:</p><div class="code-block-wrapper language-dart"><div class="code-block-body"><span class="code-block-language" title="Language dart">dart</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#D43324">    final</span><span style="color:#222222"> player =</span></span>
<span class="line"><span style="color:#0468D7">        AVAudioPlayer</span><span style="color:#222222">.</span><span style="color:#6200EE">alloc</span><span style="color:#222222">(lib).</span><span style="color:#6200EE">initWithContentsOfURL_error_</span><span style="color:#222222">(fileUrl, nullptr);</span></span></code></pre></div></div><p>Objective-C uses reference counting for memory management (through retain, release, and other functions), but on the Dart side memory management is handled automatically. The Dart wrapper object retains a reference to the Objective-C object, and when the Dart object is garbage collected, the generated code automatically releases that reference using a <a href="https://api.dart.dev/dart-ffi/NativeFinalizer-class.html"><code>NativeFinalizer</code></a>.</p><p>Next, look up the length of the audio file, which you'll need later to wait for the audio to finish. The <a href="https://developer.apple.com/documentation/avfaudio/avaudioplayer/1388395-duration?language=objc"><code>duration</code></a> is a <code>@property(readonly)</code>. Objective-C properties are translated into getters and setters on the generated Dart wrapper object. Since <code>duration</code> is <code>readonly</code>, only the getter is generated.</p><p>The resulting <code>NSTimeInterval</code> is just a type aliased <code>double</code>, so you can immediately use the Dart <code>.ceil()</code> method to round up to the next second:</p><div class="code-block-wrapper language-dart"><div class="code-block-body"><span class="code-block-language" title="Language dart">dart</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#D43324">    final</span><span style="color:#222222"> durationSeconds = player.duration.</span><span style="color:#6200EE">ceil</span><span style="color:#222222">();</span></span>
<span class="line"><span style="color:#6200EE">    print</span><span style="color:#222222">(</span><span style="color:#11796D">'</span><span style="color:#11796D">$</span><span style="color:#222222">durationSeconds</span><span style="color:#11796D"> sec'</span><span style="color:#222222">);</span></span></code></pre></div></div><p>Finally, you can use the <a href="https://developer.apple.com/documentation/avfaudio/avaudioplayer/1387388-play?language=objc"><code>play</code></a> method to play the audio, then check the status, and wait for the duration of the audio file:</p><div class="code-block-wrapper language-dart"><div class="code-block-body"><span class="code-block-language" title="Language dart">dart</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#D43324">    final</span><span style="color:#222222"> status = player.</span><span style="color:#6200EE">play</span><span style="color:#222222">();</span></span>
<span class="line"><span style="color:#D43324">    if</span><span style="color:#222222"> (status) {</span></span>
<span class="line"><span style="color:#6200EE">      print</span><span style="color:#222222">(</span><span style="color:#11796D">'Playing...'</span><span style="color:#222222">);</span></span>
<span class="line"><span style="color:#D43324">      await</span><span style="color:#0468D7"> Future</span><span style="color:#222222">&#x3C;</span><span style="color:#D43324">void</span><span style="color:#222222">>.</span><span style="color:#6200EE">delayed</span><span style="color:#222222">(</span><span style="color:#0468D7">Duration</span><span style="color:#222222">(seconds: durationSeconds));</span></span>
<span class="line"><span style="color:#222222">    } </span><span style="color:#D43324">else</span><span style="color:#222222"> {</span></span>
<span class="line"><span style="color:#6200EE">      print</span><span style="color:#222222">(</span><span style="color:#11796D">'Failed to play audio.'</span><span style="color:#222222">);</span></span>
<span class="line"><span style="color:#222222">    }</span></span></code></pre></div></div><div class="header-wrapper"><h3 id="callbacks-and-multithreading-limitations">Callbacks and multithreading limitations</h3><a class="heading-link" href="#callbacks-and-multithreading-limitations" aria-label="Link to 'Callbacks and multithreading limitations' section">#</a></div><p>Multithreading issues are the biggest limitation of Dart's experimental support for Objective-C interop. These limitations are due to the relationship between Dart isolates and OS threads, and the way Apple's APIs handle multithreading:</p><ul><li>Dart isolates are not the same thing as threads. Isolates run on threads, but aren't guaranteed to run on any particular thread, and the VM might change which thread an isolate is running on without warning. There is an <a href="https://github.com/dart-lang/sdk/issues/46943">open feature request</a> to enable isolates to be pinned to specific threads.</li><li>While <code>ffigen</code> supports converting Dart functions to Objective-C blocks, most Apple APIs don't make any guarantees about on which thread a callback will run.</li><li>Most APIs that involve UI interaction can only be called on the main thread, also called the <em>platform</em> thread in Flutter.</li><li>Many Apple APIs are <a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/ThreadSafetySummary/ThreadSafetySummary.html">not thread safe</a>.</li></ul><p>The first two points mean that a callback created in one isolate might be invoked on a thread running a different isolate, or no isolate at all. Depending on the type of callback you are using, this could cause your app to crash. Callbacks created using <a href="https://api.dart.dev/dart-ffi/Pointer/fromFunction.html"><code>Pointer.fromFunction</code></a> or <a href="https://api.dart.dev/dart-ffi/NativeCallable/NativeCallable.isolateLocal.html"><code>NativeCallable.isolateLocal</code></a> must be invoked on the owner isolate's thread, otherwise they will crash. Callbacks created using <a href="https://api.dart.dev/dart-ffi/NativeCallable/NativeCallable.listener.html"><code>NativeCallable.listener</code></a> can be safely invoked from any thread.</p><p>The third point means that directly calling some Apple APIs using the generated Dart bindings might be thread unsafe. This could crash your app, or cause other unpredictable behavior. You can work around this limitation by writing some Objective-C code that dispatches your call to the main thread. For more information, see the <a href="https://developer.apple.com/documentation/dispatch?language=objc">Objective-C dispatch documentation</a>.</p><p>Regarding the last point, although Dart isolates can switch threads, they only ever run on one thread at a time. So, the API you are interacting with doesn't necessarily have to be thread safe, as long as it is not thread hostile, and doesn't have constraints about which thread it's called from.</p><p>You can safely interact with Objective-C code, as long as you keep these limitations in mind.</p><div class="header-wrapper"><h2 id="swift-example">Swift example</h2><a class="heading-link" href="#swift-example" aria-label="Link to 'Swift example' section">#</a></div><p>This <a href="https://github.com/dart-lang/native/tree/main/pkgs/ffigen/example/swift">example</a> demonstrates how to make a Swift class compatible with Objective-C, generate a wrapper header, and invoke it from Dart code.</p><div class="header-wrapper"><h3 id="generating-the-objective-c-wrapper-header">Generating the Objective-C wrapper header</h3><a class="heading-link" href="#generating-the-objective-c-wrapper-header" aria-label="Link to 'Generating the Objective-C wrapper header' section">#</a></div><p>Swift APIs can be made compatible with Objective-C, by using the <code>@objc</code> annotation. Make sure to make any classes or methods you want to use <code>public</code>, and have your classes extend <code>NSObject</code>.</p><div class="code-block-wrapper language-swift"><div class="code-block-body"><span class="code-block-language" title="Language swift">swift</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#D43324">import</span><span style="color:#0468D7"> Foundation</span></span>
<span class="line"></span>
<span class="line"><span style="color:#222222">@</span><span style="color:#D43324">objc</span><span style="color:#D43324"> public</span><span style="color:#D43324"> class</span><span style="color:#0468D7"> SwiftClass</span><span style="color:#222222">: NSObject {</span></span>
<span class="line"><span style="color:#222222">  @</span><span style="color:#D43324">objc</span><span style="color:#D43324"> public</span><span style="color:#D43324"> func</span><span style="color:#6200EE"> sayHello</span><span style="color:#222222">() -> </span><span style="color:#0468D7">String</span><span style="color:#222222"> {</span></span>
<span class="line"><span style="color:#D43324">    return</span><span style="color:#11796D"> "Hello from Swift!"</span><span style="color:#222222">;</span></span>
<span class="line"><span style="color:#222222">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#222222">  @</span><span style="color:#D43324">objc</span><span style="color:#D43324"> public</span><span style="color:#D43324"> var</span><span style="color:#222222"> someField = </span><span style="color:#11796D">123</span><span style="color:#222222">;</span></span>
<span class="line"><span style="color:#222222">}</span></span></code></pre></div></div><p>If you're trying to interact with a third-party library, and can't modify their code, you might need to write an Objective-C compatible wrapper class that exposes the methods you want to use.</p><p>For more information about Objective-C / Swift interoperability, see the <a href="https://developer.apple.com/documentation/swift/importing-swift-into-objective-c">Swift documentation</a>.</p><p>Once you've made your class compatible, you can generate an Objective-C wrapper header. You can do this using Xcode, or using the Swift command-line compiler, <code>swiftc</code>. This example uses the command line:</p><div class="code-block-wrapper language-console"><div class="code-block-body"><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#222222">$ swiftc -c swift_api.swift             \</span></span>
<span class="line"><span style="color:#222222">    -module-name swift_module           \</span></span>
<span class="line"><span style="color:#222222">    -emit-objc-header-path swift_api.h  \</span></span>
<span class="line"><span style="color:#222222">    -emit-library -o libswiftapi.dylib</span></span></code></pre></div></div><p>This command compiles the Swift file, <code>swift_api.swift</code>, and generates a wrapper header, <code>swift_api.h</code>. It also generates the dylib you're going to load later, <code>libswiftapi.dylib</code>.</p><p>You can verify that the header generated correctly by opening it, and checking that the interfaces are what you expect. Towards the bottom of the file, you should see something like the following:</p><div class="code-block-wrapper language-objc"><div class="code-block-body"><span class="code-block-language" title="Language objc">objc</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#6200EE">SWIFT_CLASS</span><span style="color:#222222">(</span><span style="color:#11796D">"_TtC12swift_module10SwiftClass"</span><span style="color:#222222">)</span></span>
<span class="line"><span style="color:#222222">@</span><span style="color:#D43324">interface</span><span style="color:#0468D7"> SwiftClass</span><span style="color:#222222"> : NSObject</span></span>
<span class="line"><span style="color:#222222">- (</span><span style="color:#0468D7">NSString</span><span style="color:#222222"> * </span><span style="color:#D43324">_Nonnull</span><span style="color:#222222">)</span><span style="color:#6200EE">sayHello</span><span style="color:#222222"> SWIFT_WARN_UNUSED_RESULT;</span></span>
<span class="line"><span style="color:#222222">@</span><span style="color:#D43324">property</span><span style="color:#222222"> (</span><span style="color:#D43324">nonatomic</span><span style="color:#222222">) </span><span style="color:#0468D7">NSInteger</span><span style="color:#222222"> someField;</span></span>
<span class="line"><span style="color:#222222">- (</span><span style="color:#D43324">nonnull</span><span style="color:#D43324"> instancetype</span><span style="color:#222222">)</span><span style="color:#6200EE">init</span><span style="color:#222222"> OBJC_DESIGNATED_INITIALIZER;</span></span>
<span class="line"><span style="color:#222222">@</span><span style="color:#D43324">end</span></span></code></pre></div></div><p>If the interface is missing, or doesn't have all its methods, make sure they're all annotated with <code>@objc</code> and <code>public</code>.</p><div class="header-wrapper"><h3 id="configuring-ffigen-1">Configuring ffigen</h3><a class="heading-link" href="#configuring-ffigen-1" aria-label="Link to 'Configuring ffigen' section">#</a></div><p>Ffigen only sees the Objective-C wrapper header, <code>swift_api.h</code>. So most of this config looks similar to the Objective-C example, including setting the language to <code>objc</code>.</p><div class="code-block-wrapper language-yaml"><div class="code-block-body"><span class="code-block-language" title="Language yaml">yaml</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#0468D7">ffigen</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#0468D7">  name</span><span style="color:#222222">: </span><span style="color:#11796D">SwiftLibrary</span></span>
<span class="line"><span style="color:#0468D7">  description</span><span style="color:#222222">: </span><span style="color:#11796D">Bindings for swift_api.</span></span>
<span class="line"><span style="color:#0468D7">  language</span><span style="color:#222222">: </span><span style="color:#11796D">objc</span></span>
<span class="line"><span style="color:#0468D7">  output</span><span style="color:#222222">: </span><span style="color:#11796D">'swift_api_bindings.dart'</span></span>
<span class="line"><span style="color:#0468D7">  exclude-all-by-default</span><span style="color:#222222">: </span><span style="color:#11796D">true</span></span>
<span class="line"><span style="color:#0468D7">  objc-interfaces</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#0468D7">    include</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#222222">      - </span><span style="color:#11796D">'SwiftClass'</span></span>
<span class="line"><span style="color:#0468D7">    module</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#11796D">      'SwiftClass'</span><span style="color:#222222">: </span><span style="color:#11796D">'swift_module'</span></span>
<span class="line"><span style="color:#0468D7">  headers</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#0468D7">    entry-points</span><span style="color:#222222">:</span></span>
<span class="line"><span style="color:#222222">      - </span><span style="color:#11796D">'swift_api.h'</span></span>
<span class="line"><span style="color:#0468D7">  preamble</span><span style="color:#222222">: </span><span style="color:#D43324">|</span></span>
<span class="line"><span style="color:#11796D">    // ignore_for_file: camel_case_types, non_constant_identifier_names, unused_element, unused_field, return_of_invalid_type, void_checks, annotate_overrides, no_leading_underscores_for_local_identifiers, library_private_types_in_public_api</span></span></code></pre></div></div><p>As before, set the language to <code>objc</code>, and the entry point to the header; exclude everything by default, and explicitly include the interface you are binding.</p><p>One important difference between the config for a wrapped Swift API and a pure Objective-C API: the <code>objc-interfaces</code> -&gt; <code>module</code> option. When <code>swiftc</code> compiles the library, it gives the Objective-C interface a module prefix. Internally, <code>SwiftClass</code> is actually registered as <code>swift_module.SwiftClass</code>. You need to tell <code>ffigen</code> about this prefix, so it loads the correct class from the dylib.</p><p>Not every class gets this prefix. For example, <code>NSString</code> and <code>NSObject</code> won't get a module prefix, because they are internal classes. This is why the <code>module</code> option maps from class name to module prefix. You can also use regular expressions to match multiple class names at once.</p><p>The module prefix is whatever you passed to <code>swiftc</code> in the <code>-module-name</code> flag. In this example, it's <code>swift_module</code>. If you don't explicitly set this flag, it defaults to the name of the Swift file.</p><p>If you aren't sure what the module name is, you can also check the generated Objective-C header. Above the <code>@interface</code>, you'll find a <code>SWIFT_CLASS</code> macro:</p><div class="code-block-wrapper language-objc"><div class="code-block-body"><span class="code-block-language" title="Language objc">objc</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#6200EE">SWIFT_CLASS</span><span style="color:#222222">(</span><span style="color:#11796D">"_TtC12swift_module10SwiftClass"</span><span style="color:#222222">)</span></span>
<span class="line"><span style="color:#222222">@</span><span style="color:#D43324">interface</span><span style="color:#0468D7"> SwiftClass</span><span style="color:#222222"> : NSObject</span></span></code></pre></div></div><p>The string inside the macro is a bit cryptic, but you can see it contains the module name and the class name: <code>&quot;_TtC12</code><em><strong><code>swift_module</code></strong></em><code>10</code><em><strong><code>SwiftClass</code></strong></em><code>&quot;</code>.</p><p>Swift can even demangle this name for us:</p><div class="code-block-wrapper language-console"><div class="code-block-body"><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#222222">$ echo </span><span style="color:#11796D">"_TtC12swift_module10SwiftClass"</span><span style="color:#222222"> | </span><span style="color:#6200EE">swift</span><span style="color:#11796D"> demangle</span></span></code></pre></div></div><p>This outputs <code>swift_module.SwiftClass</code>.</p><div class="header-wrapper"><h3 id="generating-the-dart-bindings-1">Generating the Dart bindings</h3><a class="heading-link" href="#generating-the-dart-bindings-1" aria-label="Link to 'Generating the Dart bindings' section">#</a></div><p>As before, navigate to the example directory, and run ffigen:</p><div class="code-block-wrapper language-console"><div class="code-block-body"><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#222222">$ dart run ffigen</span></span></code></pre></div></div><p>This generates <code>swift_api_bindings.dart</code>.</p><div class="header-wrapper"><h3 id="using-the-bindings-1">Using the bindings</h3><a class="heading-link" href="#using-the-bindings-1" aria-label="Link to 'Using the bindings' section">#</a></div><p>Interacting with these bindings is exactly the same as for a normal Objective-C library:</p><div class="code-block-wrapper language-dart"><div class="code-block-body"><span class="code-block-language" title="Language dart">dart</span><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#D43324">import</span><span style="color:#11796D"> 'dart:ffi'</span><span style="color:#222222">;</span></span>
<span class="line"><span style="color:#D43324">import</span><span style="color:#11796D"> 'swift_api_bindings.dart'</span><span style="color:#222222">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D43324">void</span><span style="color:#6200EE"> main</span><span style="color:#222222">() {</span></span>
<span class="line"><span style="color:#D43324">  final</span><span style="color:#222222"> lib = </span><span style="color:#0468D7">SwiftLibrary</span><span style="color:#222222">(</span><span style="color:#0468D7">DynamicLibrary</span><span style="color:#222222">.</span><span style="color:#6200EE">open</span><span style="color:#222222">(</span><span style="color:#11796D">'libswiftapi.dylib'</span><span style="color:#222222">));</span></span>
<span class="line"><span style="color:#D43324">  final</span><span style="color:#222222"> object = </span><span style="color:#0468D7">SwiftClass</span><span style="color:#222222">.</span><span style="color:#6200EE">new1</span><span style="color:#222222">(lib);</span></span>
<span class="line"><span style="color:#6200EE">  print</span><span style="color:#222222">(object.</span><span style="color:#6200EE">sayHello</span><span style="color:#222222">());</span></span>
<span class="line"><span style="color:#6200EE">  print</span><span style="color:#222222">(</span><span style="color:#11796D">'field = </span><span style="color:#11796D">${</span><span style="color:#222222">object</span><span style="color:#11796D">.</span><span style="color:#222222">someField</span><span style="color:#11796D">}</span><span style="color:#11796D">'</span><span style="color:#222222">);</span></span>
<span class="line"><span style="color:#222222">  object.someField = </span><span style="color:#11796D">456</span><span style="color:#222222">;</span></span>
<span class="line"><span style="color:#6200EE">  print</span><span style="color:#222222">(</span><span style="color:#11796D">'field = </span><span style="color:#11796D">${</span><span style="color:#222222">object</span><span style="color:#11796D">.</span><span style="color:#222222">someField</span><span style="color:#11796D">}</span><span style="color:#11796D">'</span><span style="color:#222222">);</span></span>
<span class="line"><span style="color:#222222">}</span></span></code></pre></div></div><p>Note that the module name is not mentioned in the generated Dart API. It's only used internally, to load the class from the dylib.</p><p>Now you can run the example using:</p><div class="code-block-wrapper language-console"><div class="code-block-body"><pre class="shiki dash-light" tabindex="0"><code><span class="line"><span style="color:#222222">$ dart run example.dart</span></span></code></pre></div></div><p id="page-github-links"><span>Unless stated otherwise, the documentation on this site reflects Dart 3.6.0. Page last updated on 2024-04-11.</span> <a href="https://github.com/dart-lang/site-www/tree/main/src/content/interop/objective-c-interop.md" target="_blank" rel="noopener">View source</a> <span>or </span><a href="https://github.com/dart-lang/site-www/issues/new?template=1_page_issue.yml&amp;page-url=https://dart.dev/interop/objective-c-interop/&amp;page-source=https://github.com/dart-lang/site-www/tree/main/src/content/interop/objective-c-interop.md" title="Report an issue with this page" target="_blank" rel="noopener">report an issue</a>.</p></div></article></main><footer id="page-footer"><div class="footer-section footer-main"><a href="../index.html" class="brand" title="Dart"><img src="../assets/img/logo/logo-white-text.svg" alt="Dart" width="164"></a><div class="footer-social-links"><a href="https://medium.com/dartlang" target="_blank" rel="noopener" title="Medium blog"><svg><use href="../assets/img/social/medium.svg#medium"></use></svg> </a><a href="https://github.com/dart-lang" target="_blank" rel="noopener" title="GitHub"><svg><use href="../assets/img/social/github.svg#github"></use></svg> </a><a href="https://twitter.com/dart_lang" target="_blank" rel="noopener" title="X (Twitter)"><svg><use href="../assets/img/social/x.svg#x"></use></svg></a></div></div><div class="footer-section footer-tray"><div class="footer-licenses">Except as otherwise noted, this site is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>, and code samples are licensed under the <a href="https://opensource.org/licenses/BSD-3-Clause">3-Clause BSD License</a>.</div><div class="footer-utility-links"><ul><li><a href="../terms.html" title="Terms of use">Terms</a></li><li><a href="https://policies.google.com/privacy" target="_blank" rel="noopener" title="Privacy policy">Privacy</a></li><li><a href="../security.html" title="Security philosophy and practices">Security</a></li></ul></div></div></footer></body>
<!-- Mirrored from dart.dev/interop/objective-c-interop by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Dec 2024 22:15:08 GMT -->
</html>